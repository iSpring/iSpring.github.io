!function(t){function e(r){if(i[r])return i[r].exports;var o=i[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){i(1),t.exports=i(4)},function(t,e,i){var r,o;(function(n,a){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(n,a){"object"==s(e)&&"undefined"!=typeof t?t.exports=a():(r=a,o="function"==typeof r?r.call(e,i,e,t):r,!(void 0!==o&&(t.exports=o)))}(void 0,function(){function t(t){return"function"==typeof t||"object"==("undefined"==typeof t?"undefined":s(t))&&null!==t}function e(t){return"function"==typeof t}function r(t){J=t}function o(t){K=t}function l(){return function(){return n.nextTick(p)}}function u(){return"undefined"!=typeof Z?function(){Z(p)}:f()}function c(){var t=0,e=new tt(p),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function h(){var t=new MessageChannel;return t.port1.onmessage=p,function(){return t.port2.postMessage(0)}}function f(){var t=setTimeout;return function(){return t(p,1)}}function p(){for(var t=0;t<q;t+=2){var e=rt[t],i=rt[t+1];e(i),rt[t]=void 0,rt[t+1]=void 0}q=0}function d(){try{var t=i(3);return Z=t.runOnLoop||t.runOnContext,u()}catch(t){return f()}}function v(t,e){var i=arguments,r=this,o=new this.constructor(g);void 0===o[nt]&&F(o);var n=r._state;return n?!function(){var t=i[n-1];K(function(){return I(n,o,t,r._result)})}():A(r,o,t,e),o}function y(t){var e=this;if(t&&"object"==("undefined"==typeof t?"undefined":s(t))&&t.constructor===e)return t;var i=new e(g);return M(i,t),i}function g(){}function m(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function b(t){try{return t.then}catch(t){return ut.error=t,ut}}function w(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}function L(t,e,i){K(function(t){var r=!1,o=w(i,e,function(i){r||(r=!0,e!==i?M(t,i):P(t,i))},function(e){r||(r=!0,E(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,E(t,o))},t)}function T(t,e){e._state===st?P(t,e._result):e._state===lt?E(t,e._result):A(e,void 0,function(e){return M(t,e)},function(e){return E(t,e)})}function x(t,i,r){i.constructor===t.constructor&&r===v&&i.constructor.resolve===y?T(t,i):r===ut?(E(t,ut.error),ut.error=null):void 0===r?P(t,i):e(r)?L(t,i,r):P(t,i)}function M(e,i){e===i?E(e,m()):t(i)?x(e,i,b(i)):P(e,i)}function R(t){t._onerror&&t._onerror(t._result),C(t)}function P(t,e){t._state===at&&(t._result=e,t._state=st,0!==t._subscribers.length&&K(C,t))}function E(t,e){t._state===at&&(t._state=lt,t._result=e,K(R,t))}function A(t,e,i,r){var o=t._subscribers,n=o.length;t._onerror=null,o[n]=e,o[n+st]=i,o[n+lt]=r,0===n&&t._state&&K(C,t)}function C(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r=void 0,o=void 0,n=t._result,a=0;a<e.length;a+=3)r=e[a],o=e[a+i],r?I(i,r,o,n):o(n);t._subscribers.length=0}}function O(){this.error=null}function D(t,e){try{return t(e)}catch(t){return ct.error=t,ct}}function I(t,i,r,o){var n=e(r),a=void 0,s=void 0,l=void 0,u=void 0;if(n){if(a=D(r,o),a===ct?(u=!0,s=a.error,a.error=null):l=!0,i===a)return void E(i,_())}else a=o,l=!0;i._state!==at||(n&&l?M(i,a):u?E(i,s):t===st?P(i,a):t===lt&&E(i,a))}function B(t,e){try{e(function(e){M(t,e)},function(e){E(t,e)})}catch(e){E(t,e)}}function V(){return ht++}function F(t){t[nt]=ht++,t._state=void 0,t._result=void 0,t._subscribers=[]}function S(t,e){this._instanceConstructor=t,this.promise=new t(g),this.promise[nt]||F(this.promise),H(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?P(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&P(this.promise,this._result))):E(this.promise,G())}function G(){return new Error("Array Methods must be provided an Array")}function j(t){return new S(this,t).promise}function N(t){var e=this;return new e(H(t)?function(i,r){for(var o=t.length,n=0;n<o;n++)e.resolve(t[n]).then(i,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function U(t){var e=this,i=new e(g);return E(i,t),i}function W(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function X(t){this[nt]=V(),this._result=this._state=void 0,this._subscribers=[],g!==t&&("function"!=typeof t&&W(),this instanceof X?B(this,t):z())}function Y(){var t=void 0;if("undefined"!=typeof a)t=a;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=X}var k=void 0;k=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var H=k,q=0,Z=void 0,J=void 0,K=function(t,e){rt[q]=t,rt[q+1]=e,q+=2,2===q&&(J?J(p):ot())},$="undefined"!=typeof window?window:void 0,Q=$||{},tt=Q.MutationObserver||Q.WebKitMutationObserver,et="undefined"==typeof self&&"undefined"!=typeof n&&"[object process]"==={}.toString.call(n),it="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,rt=new Array(1e3),ot=void 0;ot=et?l():tt?c():it?h():void 0===$?d():f();var nt=Math.random().toString(36).substring(16),at=void 0,st=1,lt=2,ut=new O,ct=new O,ht=0;return S.prototype._enumerate=function(){for(var t=this.length,e=this._input,i=0;this._state===at&&i<t;i++)this._eachEntry(e[i],i)},S.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===y){var o=b(t);if(o===v&&t._state!==at)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(i===X){var n=new i(g);x(n,t,o),this._willSettleAt(n,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},S.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===at&&(this._remaining--,t===lt?E(r,i):this._result[e]=i),0===this._remaining&&P(r,this._result)},S.prototype._willSettleAt=function(t,e){var i=this;A(t,void 0,function(t){return i._settledAt(st,e,t)},function(t){return i._settledAt(lt,e,t)})},X.all=j,X.race=N,X.resolve=y,X.reject=U,X._setScheduler=r,X._setAsap=o,X._asap=K,X.prototype={constructor:X,then:v,catch:function(t){return this.then(null,t)}},X.polyfill=Y,X.Promise=X,X.polyfill(),X})}).call(e,i(2),function(){return this}())},function(t,e){"use strict";function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(c===setTimeout)return setTimeout(t,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function n(t){if(h===clearTimeout)return clearTimeout(t);if((h===r||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function a(){v&&p&&(v=!1,p.length?d=p.concat(d):y=-1,d.length&&s())}function s(){if(!v){var t=o(a);v=!0;for(var e=d.length;e;){for(p=d,d=[];++y<e;)p&&p[y].run();y=-1,e=d.length}p=null,v=!1,n(t)}}function l(t,e){this.fun=t,this.array=e}function u(){}var c,h,f=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(t){c=i}try{h="function"==typeof clearTimeout?clearTimeout:r}catch(t){h=r}}();var p,d=[],v=!1,y=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];d.push(new l(t,e)),1!==d.length||v||o(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(t,e){},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),o=i(6);i(54),function(){function t(){i.resize(window.innerWidth,window.innerHeight)}var e=new o.GlobeOptions;e.satellite=!0;var i=o.default.getInstance(e);i.placeAt(document.body),window.globe=i,window.kernel=r.default,window.addEventListener("resize",t,!1),t()}()},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=6378137,r=500,o=r/i,n=Math.PI*r,a=156543.03392800014,s=a*o,l=function(){function t(){}return t}();l.gl=null,l.idCounter=0,l.version="0.4.25",l.SCALE_FACTOR=o,l.REAL_EARTH_RADIUS=i,l.EARTH_RADIUS=r,l.MAX_RESOLUTION=s,l.MAX_REAL_RESOLUTION=a,l.MAX_PROJECTED_COORD=n,l.BASE_LEVEL=6,l.MAX_LEVEL=18,l.MIN_LEVEL=2,l.MIN_PITCH_LEVEL=8,l.proxy="",e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),o=i(7),n=i(8),a=i(9),s=i(20),l=i(22),u=i(23),c=i(24),h=i(40),f=i(41),p=i(44),d=i(48),v=i(51),y=i(19),g=i(49),m=o.default.isMobile()?11:3,_=[116.3975,39.9085],b=function(){function t(){this.satellite=!0,this.level=m,this.lonlat=_,this.key=""}return t}();e.GlobeOptions=b;var w=function(){function t(t,e){var i=this;this.canvas=t,this.renderer=null,this.scene=null,this.camera=null,this.tiledLayer=null,this.labelLayer=null,this.trafficLayer=null,this.poiLayer=null,this.routeLayer=null,this.locationGraphic=null,this.debugStopRefreshTiles=!1,this.REFRESH_INTERVAL=150,this.key="",this.lastRefreshTimestamp=-1,this.lastRefreshCameraCore=null,this.eventHandler=null,this.allRefreshCount=0,this.realRefreshCount=0,this.afterRenderCallbacks=[],this.gl=null,e||(e=new b),e.level>=r.default.MIN_LEVEL&&e.level<=r.default.MAX_LEVEL||(e.level=m),e.lonlat||(e.lonlat=_),e.key&&(this.key=e.key),this.renderer=new n.default(t,this._onBeforeRender.bind(this),this._onAfterRender.bind(this)),this.gl=this.renderer.gl,this.scene=new s.default;var l=t.width/t.height;this.camera=new a.default(t,30,l,1,2*r.default.EARTH_RADIUS,e.level,e.lonlat),this.renderer.setScene(this.scene),this.renderer.setCamera(this.camera),e.satellite?this.setTiledLayer(new c.GoogleTiledLayer("Default")):this.setTiledLayer(new h.AutonaviTiledLayer);var y=f.default.getInstance();this.scene.add(y),this.routeLayer=v.default.getInstance(this.camera),this.scene.add(this.routeLayer),this.poiLayer=d.default.getInstance(),this.poiLayer.globe=this,this.scene.add(this.poiLayer),this.locationGraphic=p.default.getInstance(this),this.scene.add(this.locationGraphic),this.renderer.resume(),this.eventHandler=new u.default(this);var w=function(t){t&&i.updateUserLocation(t)};g.default.getCurrentPosition(!1).then(w).then(function(){o.default.isMobile()&&g.default.getCurrentPosition(!0).then(w)})}return t.getInstance=function(e){if(!this.globe){var i=document.createElement("canvas");i.width=document.documentElement.clientWidth,i.height=document.documentElement.clientHeight,this.globe=new t(i,e)}return this.globe},t.prototype.placeAt=function(t){this.canvas.parentNode?this.canvas.parentNode!==t&&t.appendChild(this.canvas):t.appendChild(this.canvas)},t.prototype.resize=function(t,e){this.canvas.width=t,this.canvas.height=e,this.camera.setAspect(this.canvas.width/this.canvas.height),o.default.publish("extent-change")},t.prototype.updateUserLocation=function(t){this.locationGraphic.setLonLat(t.lon,t.lat),this.centerTo(t.lon,t.lat);var e=8;e=t.accuracy<=100?16:t.accuracy<=1e3?13:11,this.setLevel(e)},t.prototype.animateTo=function(t,e,i){},t.prototype.isPaused=function(){return this.renderer.isPaused()},t.prototype.pause=function(){this.renderer.pause()},t.prototype.resume=function(){this.isPaused&&(this.renderer.resume(),this.refresh(!0))},t.prototype.searchNearby=function(t,e,i,r){return this.poiLayer.searchNearby(t,e,i,r)},t.prototype.setTiledLayer=function(t){if(l.default.clear(),this.tiledLayer){var e=this.scene.remove(this.tiledLayer);e||console.error("this.scene.remove(this.tiledLayer)失败"),this.scene.tiledLayer=null}t.globe=this,this.tiledLayer=t,this.scene.add(this.tiledLayer,!0),this.refresh(!0)},t.prototype.showLabelLayer=function(){this.labelLayer&&(this.labelLayer.visible=!0)},t.prototype.hideLabelLayer=function(){this.labelLayer&&(this.labelLayer.visible=!1)},t.prototype.showTrafficLayer=function(){this.trafficLayer&&(this.trafficLayer.visible=!0)},t.prototype.hideTrafficLayer=function(){this.trafficLayer&&(this.trafficLayer.visible=!1)},t.prototype.getLevel=function(){return this.camera.getLevel()},t.prototype.zoomIn=function(){this.setLevel(this.getLevel()+1)},t.prototype.setLevel=function(t){this.camera&&this.camera.setLevel(t)},t.prototype.centerTo=function(t,e,i){void 0===i&&(i=this.getLevel()),this.setLevel(i),this.eventHandler.moveLonLatToCanvas(t,e,this.canvas.width/2,this.canvas.height/2)},t.prototype.isAnimating=function(){return this.camera.isAnimating()},t.prototype.animateToLevel=function(t,e){this.isAnimating()||(t<r.default.MIN_LEVEL&&(t=r.default.MIN_LEVEL),t>r.default.MAX_LEVEL&&(t=r.default.MAX_LEVEL),t!==this.getLevel()&&this.camera.animateToLevel(t,e))},t.prototype.animateOut=function(t){this.animateToLevel(this.getLevel()-1,t)},t.prototype.animateIn=function(t){this.animateToLevel(this.getLevel()+1,t)},t.prototype._onBeforeRender=function(t){this.refresh()},t.prototype._onAfterRender=function(t){this.afterRenderCallbacks.forEach(function(t){return t()}),this.afterRenderCallbacks=[]},t.prototype.logRefreshInfo=function(){console.log(this.realRefreshCount,this.allRefreshCount,this.realRefreshCount/this.allRefreshCount)},t.prototype.refresh=function(t){void 0===t&&(t=!1),this.allRefreshCount++;var e=Date.now();if(this.camera.update(t),this.tiledLayer&&this.scene&&this.camera&&!this.debugStopRefreshTiles){var i=this.camera.getCameraCore(),r=!1;r=!!t||!i.equals(this.lastRefreshCameraCore)&&e-this.lastRefreshTimestamp>=this.REFRESH_INTERVAL,this.tiledLayer.updateSubLayerCount(),r&&(this.realRefreshCount++,this.lastRefreshTimestamp=e,this.lastRefreshCameraCore=i,this.tiledLayer.refresh()),this.tiledLayer.updateTileVisibility();var o=!(!this.labelLayer||!this.labelLayer.visible),n=!(!this.trafficLayer||!this.trafficLayer.visible);if(o||n){var a=this.tiledLayer.getLastLevelVisibleTileGrids();o&&this.labelLayer.updateTiles(this.getLevel(),a),n&&this.trafficLayer.updateTiles(this.getLevel(),a)}}},t.prototype.getExtent=function(){var t=this.tiledLayer.getExtent(),e=this.camera.getExtent(),i=t;if(e){var r=y.default.intersect([t,e]);r&&(i=r)}return i},t.prototype.test=function(){this.debugStopRefreshTiles=!0,this.labelLayer.hideAllTiles(),this.tiledLayer.children.forEach(function(t){return t.hideAllTiles()});var t=this.tiledLayer.children[this.tiledLayer.children.length-1];return t.visible=!0,t.children[0].visible=!0,t},t}();w.globe=null,e.default=w},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),o={},n=function(){function t(){}return t.isNumber=function(t){return"number"==typeof t},t.isInteger=function(t){var e=!1,i=this.isNumber(t);if(i){var r=parseFloat(t),o=parseInt(t);e=r===o}else e=!1;return e},t.isPositive=function(t){return t>0},t.isNegative=function(t){return t<0},t.isNonNegative=function(t){return t>=0},t.isNonPositive=function(t){return t<=0},t.isPositiveInteger=function(t){return this.isPositive(t)&&this.isInteger(t)},t.isNonNegativeInteger=function(t){return this.isNonNegative(t)&&this.isInteger(t)},t.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t.isFunction=function(t){return"function"==typeof t},t.forEach=function(t,e){return this.isFunction(t.forEach)?t.forEach(e):Array.prototype.forEach.call(t,e)},t.filter=function(t,e){return this.isFunction(t.filter)?t.filter(e):Array.prototype.filter.call(t,e)},t.map=function(t,e){return this.isFunction(t.map)?t.map(e):Array.prototype.map.call(t,e)},t.some=function(t,e){return this.isFunction(t.some)?t.some(e):Array.prototype.some.call(t,e)},t.every=function(t,e){return this.isFunction(t.every)?t.every(e):Array.prototype.every.call(t,e)},t.filterRepeatArray=function(t){for(var e=t.map(function(t){return t}),i=[];e.length>0;){var r=e[0],o=i.some(function(t){return r.equals(t)});o||i.push(r),e.splice(0,1)}return i},t.isMobile=function(){return!!window.navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone|IEMobile|Opera Mini/i)},t.wrapUrlWithProxy=function(t){return r.default.proxy?r.default.proxy+"?"+t:t},t.subscribe=function(t,e){o[t]||(o[t]=[]),o[t].push(e)},t.publish=function(t,e){var i=o[t];i&&i.length>0&&i.forEach(function(t){t(e)})},t}();e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),o=function(){function t(t,e,i){this.canvas=t,this.onBeforeRender=e,this.onAfterRender=i,this.scene=null,this.camera=null,this.paused=!0,this.gl=null,this.gl=this._getWebGLContext(this.canvas),r.default.gl=this.gl,this.gl||console.debug("浏览器不支持WebGL或将WebGL禁用!");var o=this.gl;o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.clearColor(0,0,0,1),o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL),o.depthMask(!0),o.enable(o.CULL_FACE),o.frontFace(o.CCW),o.cullFace(o.BACK)}return t.prototype._getWebGLContext=function(t){var e=null;try{for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=0;r<i.length&&!(e=t.getContext(i[r],{antialias:!0}));r++);}catch(t){console.error(t)}return e},t.prototype.render=function(t,e){var i=this.gl;i.viewport(0,0,this.canvas.width,this.canvas.height),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.clearColor(0,0,0,1),e.update(),this.onBeforeRender&&this.onBeforeRender(this),t.draw(e),this.onAfterRender&&this.onAfterRender(this)},t.prototype.setScene=function(t){this.scene=t},t.prototype.setCamera=function(t){this.camera=t},t.prototype._tick=function(){this.scene&&this.camera&&this.render(this.scene,this.camera),this.paused||window.requestAnimationFrame(this._tick.bind(this))},t.prototype.isPaused=function(){return this.paused},t.prototype.pause=function(){this.paused=!0},t.prototype.resume=function(){this.paused=!1,this._tick()},t}();e.default=o},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(7),a=i(10),s=i(11),l=i(12),u=i(13),c=i(14),h=i(16),f=i(17),p=i(18),d=i(19),v=function(){function t(t,e,i,r,o,n){this.fov=t,this.aspect=e,this.near=i,this.far=r,this.floatLevel=o,this.matrix=n}return t.prototype.getFov=function(){return this.fov},t.prototype.getAspect=function(){return this.aspect},t.prototype.getNear=function(){return this.near},t.prototype.getFar=function(){return this.far},t.prototype.getFloatLevel=function(){return this.floatLevel},t.prototype.getMatrix=function(){return this.matrix},t.prototype.equals=function(t){return!!t&&(this.fov===t.getFov()&&this.aspect===t.getAspect()&&this.near===t.getNear()&&this.far===t.getFar()&&this.floatLevel===t.getFloatLevel()&&this.matrix.equals(t.getMatrix()))},t}();e.CameraCore=v;var y={};!function(){for(var t=0;t<=o.default.MAX_LEVEL;t++)y[t]=o.default.MAX_REAL_RESOLUTION/Math.pow(2,t)}();var g=function(t){function e(e,i,r,o,n,s,l){void 0===i&&(i=45),void 0===r&&(r=1),void 0===o&&(o=1),void 0===n&&(n=100),void 0===s&&(s=3),void 0===l&&(l=[0,0]);var u=t.call(this)||this;return u.canvas=e,u.fov=i,u.aspect=r,u.near=o,u.far=n,u.animationDuration=200,u.nearFactor=.6,u.maxPitch=40,u.resolutionFactor1=Math.pow(2,.375295),u.resolutionFactor2=Math.pow(2,1.375295),u.isZeroPitch=!0,u.level=-1,u.floatLevel=-2,u.lastFloatLevel=-3,u.lastFov=-1,u.lastAspect=-1,u.lastNear=-1,u.lastFar=-1,u.lonlatsOfBoundary=null,u.animating=!1,u.eventEmitter=null,u.eventEmitter=new a.EventEmitter,u.lonlatsOfBoundary=[],u.initFov=u.fov,u.lastMatrix=new f.default,u.lastMatrix.setUniqueValue(0),u.projMatrix=new f.default,u._rawSetPerspectiveMatrix(u.fov,u.aspect,u.near,u.far),u._initCameraPosition(s,l[0],l[1]),u.update(!0),u}return r(e,t),e.prototype.getExtent=function(){var t=null;if(this.isEarthFullOverlapScreen()){var e=[],i=[];this.lonlatsOfBoundary.forEach(function(t){e.push(t[0]),i.push(t[1])});var r=Math.min.apply(Math,e),o=Math.max.apply(Math,e),n=Math.min.apply(Math,i),a=Math.max.apply(Math,i);t=new d.default(r,n,o,a)}return t},e.prototype.getEventEmitter=function(){return this.eventEmitter},e.prototype.isEarthFullOverlapScreen=function(){return 8===this.lonlatsOfBoundary.length},e.prototype.getTileGridsOfBoundary=function(t,e){var i=this.lonlatsOfBoundary.map(function(e){return h.default.getTileGridByGeo(e[0],e[1],t)});return e?n.default.filterRepeatArray(i):i},e.prototype.toJson=function(){function t(t){return t?t.toJson():null}var e={matrix:t(this.matrix),isZeroPitch:this.isZeroPitch,level:this.level,floatLevel:this.floatLevel,lastFloatLevel:this.lastFloatLevel,lastMatrix:t(this.lastMatrix),lastFov:this.lastFov,lastAspect:this.lastAspect,lastNear:this.lastNear,lastFar:this.lastFar,viewMatrix:t(this.viewMatrix),projMatrix:t(this.projMatrix),projViewMatrix:t(this.projViewMatrix),matrixForDraw:t(this.matrixForDraw),viewMatrixForDraw:t(this.viewMatrixForDraw),projMatrixForDraw:t(this.projMatrixForDraw),projViewMatrixForDraw:t(this.projViewMatrixForDraw),animating:this.animating};return e},e.prototype.toJsonString=function(){return JSON.stringify(this.toJson())},e.prototype.fromJson=function(t){this.matrix=f.default.fromJson(t.matrix),this.isZeroPitch=t.isZeroPitch,this.level=t.level,this.floatLevel=t.floatLevel,this.lastFloatLevel=t.lastFloatLevel,this.lastMatrix=f.default.fromJson(t.lastMatrix),this.lastFov=t.lastFov,this.lastAspect=t.lastAspect,this.lastNear=t.lastNear,this.lastFar=t.lastFar,this.viewMatrix=f.default.fromJson(t.viewMatrix),this.projMatrix=f.default.fromJson(t.projMatrix),this.projViewMatrix=f.default.fromJson(t.projViewMatrix),this.matrixForDraw=f.default.fromJson(t.matrixForDraw),this.viewMatrixForDraw=f.default.fromJson(t.viewMatrixForDraw),this.projMatrixForDraw=f.default.fromJson(t.projMatrixForDraw),this.projViewMatrixForDraw=f.default.fromJson(t.projViewMatrixForDraw),this.animating=t.animating,this.update(!0)},e.prototype.fromJsonString=function(t){this.fromJson(JSON.parse(t))},e.prototype._setPerspectiveMatrix=function(t,e,i,r){this._rawSetPerspectiveMatrix(t,e,i,r),this._updateFar()},e.prototype._rawSetPerspectiveMatrix=function(t,e,i,r,o){void 0===o&&(o=this.projMatrix),this.projMatrix===o&&(this.fov=t,this.aspect=e,this.near=i,this.far=r);var n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a=t*Math.PI/180/2,s=1/Math.tan(a),l=1/(i-r);n[0]=s/e,n[5]=s,n[10]=(r+i)*l,n[11]=-1,n[14]=2*i*r*l,n[15]=0,o.setElements(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])},e.prototype._setFov=function(t){if(!(t>0))throw"invalid fov:"+t;this._setPerspectiveMatrix(t,this.aspect,this.near,this.far)},e.prototype.setAspect=function(t){if(!(t>0))throw"invalid aspect:"+t;this._setPerspectiveMatrix(this.fov,t,this.near,this.far),this.setLevel(this.level,!0)},e.prototype._updateFar=function(){},e.prototype._getMinimalFar=function(t){var e=u.default.fromVertice(t).getLength(),i=Math.sqrt(e*e-o.default.EARTH_RADIUS*o.default.EARTH_RADIUS);return i*=1.05},e.prototype.update=function(t){void 0===t&&(t=!1);var e=this._updateCore(t);return e&&this._updateTileGridsOfBoundary(),e},e.prototype._updateCore=function(t){void 0===t&&(t=!1);var e=t||this._isNeedUpdate();return e&&(this._normalUpdate(),this._updateProjViewMatrixForDraw()),this.lastFov=this.fov,this.lastAspect=this.aspect,this.lastNear=this.near,this.lastFar=this.far,this.lastFloatLevel=this.floatLevel,this.lastMatrix.setMatrixByOther(this.matrix),e},e.prototype._updateTileGridsOfBoundary=function(){var t=this,e=[],i=[[-1,1],[-1,0],[-1,-1],[1,1],[1,0],[1,-1],[0,1],[0,-1]];i.forEach(function(i){var r=t._getPickLonLatByNDC(i[0],i[1]);r&&r.length>0&&e.push(r)}),this.lonlatsOfBoundary=e},e.prototype.getCameraCore=function(){return new v(this.fov,this.aspect,this.near,this.far,this.floatLevel,this.matrix.clone())},e.prototype._isNeedUpdate=function(){return this.fov!==this.lastFov||this.aspect!==this.lastAspect||this.near!==this.lastNear||this.far!==this.lastFar||this.floatLevel!==this.lastFloatLevel||!this.matrix.equals(this.lastMatrix)},e.prototype.getProjViewMatrixForDraw=function(){return this.projViewMatrixForDraw},e.prototype._normalUpdate=function(){this.viewMatrix=this.matrix.getInverseMatrix(),this._updateFar(),this.projViewMatrix=this.projMatrix.multiplyMatrix(this.viewMatrix)},e.prototype._updateProjViewMatrixForDraw=function(){this.matrixForDraw=this.matrix.clone();var t=this._updatePositionAndFov(this.matrixForDraw),e=this.aspect,i=this.near,r=this.far;this.projMatrixForDraw=new f.default,this._rawSetPerspectiveMatrix(t,e,i,r,this.projMatrixForDraw),this.viewMatrixForDraw=this.matrixForDraw.getInverseMatrix(),this.projViewMatrixForDraw=this.projMatrixForDraw.multiplyMatrix(this.viewMatrixForDraw)},e.prototype._updatePositionAndFov=function(t){var e=this.animating?this.floatLevel:this.level,i=this._getSafeThresholdLevelForNear();if(e>i){this._updatePositionByLevel(i,t);var r=e-i,o=this._calculateFovByDeltaLevel(this.initFov,r);return o}return this._updatePositionByLevel(e,t),this.initFov},e.prototype._getSafeThresholdLevelForNear=function(){var t=this.near*this.nearFactor,e=this._calculateResolutionAndBestDisplayLevelByDistance2EarthSurface(t),i=e[1];return i},e.prototype._calculateDeltaLevelByFov=function(t,e){var i=s.default.degreeToRadian(t),r=i/2,o=Math.tan(r),n=s.default.degreeToRadian(e),a=n/2,l=Math.tan(a),u=s.default.log2(o/l);return u},e.prototype._calculateFovByDeltaLevel=function(t,e){var i=s.default.degreeToRadian(t),r=i/2,o=Math.tan(r),n=o/Math.pow(2,e),a=Math.atan(n),l=2*a,u=s.default.radianToDegree(l);return u},e.prototype.measureXYResolutionAndBestDisplayLevel=function(){var t=this.matrix.getPosition(),e=u.default.fromVertice(t),i=new c.default(t,e),r=this._getPickCartesianCoordInEarthByLine(i),n=r[0],a=this._convertVerticeFromWorldToNDC(n),l=s.default.convertPointFromNdcToCanvas(this.canvas.width,this.canvas.height,a.x,a.y),h=l[0],f=l[1],p=10,d=this.getPickCartesianCoordInEarthByCanvas(h-p,f),v=u.default.fromVertice(d[0]),y=this.getPickCartesianCoordInEarthByCanvas(h+p,f),g=u.default.fromVertice(y[0]),m=u.default.getRadianOfTwoVectors(v,g),_=m*o.default.EARTH_RADIUS/(2*p)*this.resolutionFactor1,b=this._calculateLevelByResolution(_),w=this.getPickCartesianCoordInEarthByCanvas(h,f+p),L=u.default.fromVertice(w[0]),T=this.getPickCartesianCoordInEarthByCanvas(h,f-p),x=u.default.fromVertice(T[0]),M=u.default.getRadianOfTwoVectors(L,x),R=M*o.default.EARTH_RADIUS/(2*p)*this.resolutionFactor1,P=this._calculateLevelByResolution(R);return{resolutionX:_,bestDisplayLevelFloatX:b,resolutionY:R,bestDisplayLevelFloatY:P}},e.prototype.calculateCurrentResolutionAndBestDisplayLevel=function(){var t=this.getDistance2EarthOrigin();return this._calculateResolutionAndBestDisplayLevelByDistance2EarthOrigin(t)},e.prototype._calculateResolutionAndBestDisplayLevelByDistance2EarthOrigin=function(t){var e=s.default.degreeToRadian(this.fov/2),i=Math.atan(2/this.canvas.height*Math.tan(e)),r=Math.asin(t*Math.sin(i)/o.default.EARTH_RADIUS),n=r-i,a=n*o.default.EARTH_RADIUS*this.resolutionFactor2,l=this._calculateLevelByResolution(a);return[a,l]},e.prototype._calculateResolutionAndBestDisplayLevelByDistance2EarthSurface=function(t){var e=t+o.default.EARTH_RADIUS;return this._calculateResolutionAndBestDisplayLevelByDistance2EarthOrigin(e)},e.prototype._calculateDistance2EarthSurfaceByBestDisplayLevel=function(t){return this._calculateDistance2EarthOriginByBestDisplayLevel(t)-o.default.EARTH_RADIUS},e.prototype._calculateDistance2EarthOriginByBestDisplayLevel=function(t){var e=this._calculateResolutionByLevel(t);return this._calculateDistance2EarthOriginByResolution(e)},e.prototype._calculateDistance2EarthOriginByResolution=function(t){t/=this.resolutionFactor2;var e=s.default.degreeToRadian(this.fov/2),i=Math.atan(2/this.canvas.height*Math.tan(e)),r=t/o.default.EARTH_RADIUS,n=i+r,a=o.default.EARTH_RADIUS*Math.sin(n)/Math.sin(i);return a},e.prototype._calculateLevelByResolution=function(t){var e=o.default.MAX_RESOLUTION/t,i=s.default.log2(e);return i},e.prototype._calculateResolutionByLevel=function(t){return o.default.MAX_RESOLUTION/Math.pow(2,t)},e.prototype.getResolutionInWorld=function(){return y.hasOwnProperty(this.level)?y[this.level]:o.default.MAX_REAL_RESOLUTION/Math.pow(2,this.level)},e.prototype.getLonlat=function(){var t=u.default.fromVertice(this.getPosition());t.setLength(o.default.EARTH_RADIUS);var e=t.getVertice(),i=s.default.cartesianCoordToGeographic(e);return i},e.prototype.getLevel=function(){return this.level},e.prototype.setLevel=function(t,e){if(void 0===e&&(e=!1),!n.default.isNonNegativeInteger(t))throw"invalid level:"+t;if(t<o.default.MIN_LEVEL&&(t=o.default.MIN_LEVEL),t>o.default.MAX_LEVEL&&(t=o.default.MAX_LEVEL),t!==this.level||e){var i=this.level;this._updatePositionByLevel(t,this.matrix),this.level=t,this.floatLevel=t,n.default.publish("level-change",{oldLevel:i,newLevel:this.level})}},e.prototype._initCameraPosition=function(t,e,i){var r=this._calculateDistance2EarthOriginByBestDisplayLevel(t),o=s.default.geographicToCartesianCoord(e,i,r),n=new l.default(0,0,0),a=this.getLightDirection().getOpposite();a.setLength(r),this._look(o,n),this.setLevel(t)},e.prototype._updatePositionByLevel=function(t,e){var i=this._getDirectionIntersectPointWithEarth(e);if(0===i.length)throw"no intersect";var r=i[0],o=this._calculateDistance2EarthSurfaceByBestDisplayLevel(t),n=e.getVectorZ();n.setLength(o);var a=u.default.verticePlusVector(r,n);e.setPosition(a)},e.prototype.setDeltaPitch=function(t){if(!(this.level<o.default.MIN_PITCH_LEVEL)&&this.isEarthFullOverlapScreen()){var e=this.getPitch(),i=e+t;if(!(i>this.maxPitch)&&(i<0&&(i=0),t=i-e,0!==t)){var r=this._getDirectionIntersectPointWithEarth(this.matrix);if(0===r.length)throw"no intersects";var n=r[0],a=s.default.degreeToRadian(t),l=this.matrix.clone();l.setPosition(n),l.localRotateX(a),this._updatePositionByLevel(this.level,l),this.isZeroPitch=0===i,this.matrix=l}}},e.prototype.getPitch=function(){if(this.isZeroPitch)return 0;var t=this._getDirectionIntersectPointWithEarth(this.matrix);if(0===t.length)throw"no intersects";var e=t[0],i=u.default.fromVertice(e),r=i.getLength(),o=u.default.verticeMinusVertice(this.getPosition(),e),n=o.getLength(),a=i.dot(o)/(r*n),l=s.default.acosSafely(a),c=i.cross(o),h=this.matrix.getVectorX();l=c.dot(h)?Math.abs(l):-Math.abs(l);var f=s.default.radianToDegree(l);if(f>=90)throw"Invalid pitch: "+f;return f},e.prototype.getPickCartesianCoordInEarthByCanvas=function(t,e){this._updateCore();var i=this.matrix,r=this.viewMatrix,o=this.projMatrix,n=this.projViewMatrix;this.matrix=this.matrixForDraw,this.viewMatrix=this.viewMatrixForDraw,this.projMatrix=this.projMatrixForDraw,this.projViewMatrix=this.projViewMatrixForDraw;var a=this._getPickDirectionByCanvas(t,e),s=this.getPosition(),l=new c.default(s,a),u=this._getPickCartesianCoordInEarthByLine(l);return this.matrix=i,this.viewMatrix=r,this.projMatrix=o,this.projViewMatrix=n,u},e.prototype.getLightDirection=function(){var t=this.matrix.getVectorZ(),e=new u.default(-t.x,-t.y,-t.z);return e.normalize(),
e},e.prototype.getDistance2EarthSurface=function(){var t=this.getPosition(),e=u.default.fromVertice(t).getLength()-o.default.EARTH_RADIUS;return e},e.prototype.getDistance2EarthOrigin=function(){var t=this.getPosition();return u.default.fromVertice(t).getLength()},e.prototype.isAnimating=function(){return this.animating},e.prototype.animateToLevel=function(t,e){var i=this;if(!this.isAnimating()){if(!n.default.isNonNegativeInteger(t))throw"invalid level:"+t;var r=this.matrix.clone();this._updatePositionByLevel(t,r);var o=r.getPosition(),a=this.getPosition(),s=this.animationDuration,u=1e3/60,c=Math.floor(s/u),h=(o.x-a.x)/c,f=(o.y-a.y)/c,p=(o.z-a.z)/c,d=(t-this.level)/c,v=-1;this.floatLevel=this.level,this.animating=!0;var y=function(r){v<0&&(v=r);var o=r-v;if(o>=s)i.animating=!1,i.floatLevel=t,i.setLevel(t),e&&e();else{i.floatLevel+=d;var n=i.getPosition();i.setPosition(new l.default(n.x+h,n.y+f,n.z+p)),requestAnimationFrame(y)}};requestAnimationFrame(y)}},e.prototype._look=function(t,e,i){void 0===i&&(i=new u.default(0,1,0));var r=t.clone(),o=e.clone(),n=i.clone(),a=new u.default(r.x-o.x,r.y-o.y,r.z-o.z);a.normalize();var s=n.cross(a).normalize(),l=a.cross(s).normalize();this.matrix.setVectorX(s),this.matrix.setVectorY(l),this.matrix.setVectorZ(a),this.matrix.setPosition(r),this.matrix.setLastRowDefault(),this._updateFar()},e.prototype._lookAt=function(t,e){var i=t.clone(),r=this.getPosition();this._look(r,i,e)},e.prototype._getPickDirectionByCanvas=function(t,e){var i=s.default.convertPointFromCanvasToNDC(this.canvas.width,this.canvas.height,t,e),r=this._getPickDirectionByNDC(i[0],i[1]);return r},e.prototype._getDirectionIntersectPointWithEarth=function(t){var e=t.getVectorZ().getOpposite(),i=t.getPosition(),r=new c.default(i,e),o=this._getPickCartesianCoordInEarthByLine(r);return o},e.prototype._getPickDirectionByNDC=function(t,e){var i=new l.default(t,e,.499),r=this._convertVerticeFromNdcToWorld(i),o=this.getPosition(),n=u.default.verticeMinusVertice(r,o);return n.normalize(),n},e.prototype._getPickCartesianCoordInEarthByLine=function(t){var e=[],i=s.default.getLineIntersectPointWithEarth(t);if(0===i.length)e=[];else if(1==i.length)e=i;else if(2==i.length){var r=i[0],o=i[1],n=this.getPosition(),a=s.default.getLengthFromVerticeToVertice(n,r),l=s.default.getLengthFromVerticeToVertice(n,o);e=a<=l?[r,o]:[o,r]}return e},e.prototype._getPickLonLatByNDC=function(t,e){var i=null,r=this._getPickCartesianCoordInEarthByNDC(t,e);return r.length>0&&(i=s.default.cartesianCoordToGeographic(r[0])),i},e.prototype._getPickCartesianCoordInEarthByNDC=function(t,e){var i=this._getPickDirectionByNDC(t,e),r=this.getPosition(),o=new c.default(r,i),n=this._getPickCartesianCoordInEarthByLine(o);return n},e.prototype._getPlanXOZ=function(){var t=this.getPosition(),e=this.getLightDirection(),i=s.default.getCrossPlaneByLine(t,e);return i},e.prototype._convertVerticeFromWorldToNDC=function(t){var e=[t.x,t.y,t.z,1],i=this.projViewMatrix.multiplyColumn(e),r=i[3],o=[];o[0]=i[0]/r,o[1]=i[1]/r,o[2]=i[2]/r,o[3]=1;var n=new l.default(o[0],o[1],o[2]);return n},e.prototype._convertVerticeFromNdcToWorld=function(t){var e=[t.x,t.y,t.z,1],i=this.projMatrix.getInverseMatrix(),r=i.multiplyColumn(e),o=r[0]/r[3],n=r[1]/r[3],a=r[2]/r[3],s=1,u=[o,n,a,s],c=this.matrix.multiplyColumn(u),h=new l.default(c[0],c[1],c[2]);return h},e.prototype._convertVerticeFromCameraToWorld=function(t){var e=t.clone(),i=[e.x,e.y,e.z,1],r=this.matrix.multiplyColumn(i),o=new l.default(r[0],r[1],r[2]);return o},e.prototype._convertVectorFromCameraToWorld=function(t){var e=t.clone(),i=e.getVertice(),r=this._convertVerticeFromCameraToWorld(i),o=this.getPosition(),n=u.default.verticeMinusVertice(r,o);return n.normalize(),n},e.prototype._isWorldVerticeVisibleInCanvas=function(t,e){void 0===e&&(e={});var i="number"==typeof e.threshold?Math.abs(e.threshold):1,r=this.getPosition(),o=u.default.verticeMinusVertice(t,r),n=new c.default(r,o),a=this._getPickCartesianCoordInEarthByLine(n);if(a.length>0){var h=a[0],f=s.default.getLengthFromVerticeToVertice(r,t),p=s.default.getLengthFromVerticeToVertice(r,h);if(f<p+5){e.verticeInNDC instanceof l.default||(e.verticeInNDC=this._convertVerticeFromWorldToNDC(t));var d=e.verticeInNDC.x>=-1&&e.verticeInNDC.x<=1&&e.verticeInNDC.y>=-i&&e.verticeInNDC.y<=1;return d}}return!1},e.prototype._isGeoVisibleInCanvas=function(t,e,i){var r=s.default.geographicToCartesianCoord(t,e),o=this._isWorldVerticeVisibleInCanvas(r,i);return o},e.prototype.getVisibleTilesByLevel=function(t,e){function i(t){return!!(t.area>=5e3&&t.clockwise&&t.visibleCount>=1)}function r(r,o){var s=[],l=new h.default(t,r,o),u=this._getTileVisibleInfo(l.level,l.row,l.column,e),c=i(u);if(c){l.visibleInfo=u,s.push(l);for(var f,p=0,d=o;p<n&&(p++,l=h.default.getTileGridByBrother(t,r,d,h.TileGridPosition.LEFT,a),d=l.column,u=this._getTileVisibleInfo(l.level,l.row,l.column,e),f=i(u));)l.visibleInfo=u,s.push(l);for(var v=0,y=o;v<n&&(v++,l=h.default.getTileGridByBrother(t,r,y,h.TileGridPosition.RIGHT,a),y=l.column,u=this._getTileVisibleInfo(l.level,l.row,l.column,e),f=i(u));)l.visibleInfo=u,s.push(l)}return s}if(void 0===e&&(e={}),!(t>=0))throw"invalid level";var o=[],n=Math.min(10,Math.pow(2,t)-1),a={maxSize:Math.pow(2,t)},s=null,l=this._getVerticalVisibleCenterInfo();s=h.default.isValidLatitude(l.lat)?h.default.getTileGridByGeo(l.lon,l.lat,t):new h.default(t,0,0);var u=r.bind(this),c=u(s.row,s.column);o=o.concat(c);for(var f,p=0,d=s.row;p<n&&(p++,f=h.default.getTileGridByBrother(t,d,s.column,h.TileGridPosition.BOTTOM,a),d=f.row,c=u(f.row,f.column),c.length>0);)o=o.concat(c);for(var v=0,y=s.row;v<n&&(v++,f=h.default.getTileGridByBrother(t,y,s.column,h.TileGridPosition.TOP,a),y=f.row,c=u(f.row,f.column),c.length>0);)o=o.concat(c);return o},e.prototype._getTileVisibleInfo=function(t,e,i,r){if(!(t>=0))throw"invalid level";if(!(e>=0))throw"invalid row";if(!(i>=0))throw"invalid column";var o="number"==typeof r.threshold?Math.abs(r.threshold):1;r.threshold=o;var n={lb:{lon:null,lat:null,verticeInWorld:null,verticeInNDC:null,visible:!1},lt:{lon:null,lat:null,verticeInWorld:null,verticeInNDC:null,visible:!1},rt:{lon:null,lat:null,verticeInWorld:null,verticeInNDC:null,visible:!1},rb:{lon:null,lat:null,verticeInWorld:null,verticeInNDC:null,visible:!1},Egeo:null,visibleCount:0,clockwise:!1,width:null,height:null,area:null};n.Egeo=s.default.getTileGeographicEnvelopByGrid(t,e,i);var a=n.Egeo.minLon,l=n.Egeo.maxLon,c=n.Egeo.minLat,h=n.Egeo.maxLat;n.lb.lon=a,n.lb.lat=c,n.lb.verticeInWorld=s.default.geographicToCartesianCoord(n.lb.lon,n.lb.lat),n.lb.verticeInNDC=this._convertVerticeFromWorldToNDC(n.lb.verticeInWorld),n.lb.visible=this._isWorldVerticeVisibleInCanvas(n.lb.verticeInWorld,{verticeInNDC:n.lb.verticeInNDC,threshold:o}),n.lb.visible&&n.visibleCount++,n.lt.lon=a,n.lt.lat=h,n.lt.verticeInWorld=s.default.geographicToCartesianCoord(n.lt.lon,n.lt.lat),n.lt.verticeInNDC=this._convertVerticeFromWorldToNDC(n.lt.verticeInWorld),n.lt.visible=this._isWorldVerticeVisibleInCanvas(n.lt.verticeInWorld,{verticeInNDC:n.lt.verticeInNDC,threshold:o}),n.lt.visible&&n.visibleCount++,n.rt.lon=l,n.rt.lat=h,n.rt.verticeInWorld=s.default.geographicToCartesianCoord(n.rt.lon,n.rt.lat),n.rt.verticeInNDC=this._convertVerticeFromWorldToNDC(n.rt.verticeInWorld),n.rt.visible=this._isWorldVerticeVisibleInCanvas(n.rt.verticeInWorld,{verticeInNDC:n.rt.verticeInNDC,threshold:o}),n.rt.visible&&n.visibleCount++,n.rb.lon=l,n.rb.lat=c,n.rb.verticeInWorld=s.default.geographicToCartesianCoord(n.rb.lon,n.rb.lat),n.rb.verticeInNDC=this._convertVerticeFromWorldToNDC(n.rb.verticeInWorld),n.rb.visible=this._isWorldVerticeVisibleInCanvas(n.rb.verticeInWorld,{verticeInNDC:n.rb.verticeInNDC,threshold:o}),n.rb.visible&&n.visibleCount++;var f=[n.lb.verticeInNDC,n.lt.verticeInNDC,n.rt.verticeInNDC,n.rb.verticeInNDC],p=u.default.verticeMinusVertice(f[3],f[0]);p.z=0;var d=u.default.verticeMinusVertice(f[1],f[0]);d.z=0;var v=p.cross(d);n.clockwise=v.z>0;var y=Math.sqrt(Math.pow(f[1].x-f[2].x,2)+Math.pow(f[1].y-f[2].y,2))*this.canvas.width/2,g=Math.sqrt(Math.pow(f[0].x-f[3].x,2)+Math.pow(f[0].y-f[3].y,2))*this.canvas.width/2;n.width=Math.floor((y+g)/2);var m=Math.sqrt(Math.pow(f[0].x-f[1].x,2)+Math.pow(f[0].y-f[1].y,2))*this.canvas.height/2,_=Math.sqrt(Math.pow(f[2].x-f[3].x,2)+Math.pow(f[2].y-f[3].y,2))*this.canvas.height/2;return n.height=Math.floor((m+_)/2),n.area=n.width*n.height,n},e.prototype._getVerticalVisibleCenterInfo=function(){var t,e={ndcY:null,pIntersect:null,lon:null,lat:null};if(this.isZeroPitch)e.ndcY=0;else{var i,r=10,o=2/r,n=1,a=-1;for(i=1;i>=-1;i-=o)if(t=this._getPickCartesianCoordInEarthByNDC(0,i),t.length>0){n=i;break}for(i=-1;i<=1;i+=o)if(t=this._getPickCartesianCoordInEarthByNDC(0,i),t.length>0){a=i;break}e.ndcY=(n+a)/2}t=this._getPickCartesianCoordInEarthByNDC(0,e.ndcY),e.pIntersect=t[0];var l=s.default.cartesianCoordToGeographic(e.pIntersect);return e.lon=l[0],e.lat=l[1],e},e}(p.default);e.default=g},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.events=null,this.events={}}return t.prototype.emit=function(t,e){var i=this.events[t];i&&i.forEach(function(t){t(e)})},t.prototype.on=function(t,e){return this.addEventListener(t,e)},t.prototype.addEventListener=function(t,e){var i=this,r=this.events[t];r?r.push(e):this.events[t]=[e];var o={};return o.remove=function(){return i.removeEventListener(t,e)},o},t.prototype.removeEventListener=function(t,e){var i=this.events[t];if(i){var r=i.indexOf(e);r>=0&&i.splice(r,1)}},t.prototype.removeAllEventListeners=function(t){t?this.events[t]=[]:this.events={}},t}();e.EventEmitter=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),o=i(7),n=i(12),a=i(13),s=i(14),l=i(15);Math.log2||(Math.log2=function(t){return Math.log(t)/Math.log(2)});var u={};!function(t){t[0]=1;for(var e=1;e<=20;e++)t[e]=t[e-1]<<1,t[-e]=1/t[e]}(u);var c=57.29577951308232,h=.017453292519943295,f=function(){function t(){}return t.getRealValueInWorld=function(t){return t/r.default.SCALE_FACTOR},t.pow2=function(t){var e=t.toString();return u.hasOwnProperty(e)?u[e]:Math.pow(2,t)},t.log2=function(t){return Math.log2(t)},t.izZero=function(t){if(!o.default.isNumber(t))throw"invalid value";return Math.abs(t)<1e-6},t.isPowerOfTwo=function(t){return 0===(t&t-1)&&0!==t},t.asinSafely=function(t){return t>1&&(t=1),t<-1&&(t=-1),Math.asin(t)},t.acosSafely=function(t){return t>1&&(t=1),t<-1&&(t=-1),Math.acos(t)},t.numerationSystemTo10=function(t,e){for(var i=0,r=0;r<e.length;r++){var o=e.length-1-r,n=parseInt(e[r]);i+=n*Math.pow(t,o)}return i},t.numerationSystemFrom10=function(t,e){return e.toString(t)},t.numerationSystemChange=function(t,e,i){var r=this.numerationSystemTo10(t,i),o=this.numerationSystemFrom10(e,r);return o},t.getTriangleArea=function(t,e,i){var r=t.clone(),o=e.clone(),n=i.clone(),l=a.default.verticeMinusVertice(n,o),u=new s.default(o,l),c=this.getLengthFromVerticeToLine(r,u),h=this.getLengthFromVerticeToVertice(o,n),f=.5*h*c;return f},t.getLengthFromVerticeToVertice=function(t,e){var i=t.clone(),r=e.clone(),o=Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)+Math.pow(i.z-r.z,2),n=Math.sqrt(o);return n},t.getLengthFromVerticeToLine=function(t,e){var i=t.clone(),r=e.clone(),o=i.x,n=i.y,a=i.z,s=r.vertice,l=s.x,u=s.y,c=s.z,h=r.vector;h.normalize();var f=h.x,p=h.y,d=h.z,v=(n-u)*d-p*(a-c),y=(a-c)*f-d*(o-l),g=(o-l)*p-f*(n-u);return Math.sqrt(v*v+y*y+g*g)},t.getLengthFromVerticeToPlan=function(t,e){var i=t.clone(),r=e.clone(),o=i.x,n=i.y,a=i.z,s=r.A,l=r.B,u=r.C,c=r.D,h=Math.abs(s*o+l*n+u*a+c),f=Math.sqrt(s*s+l*l+u*u),p=h/f;return p},t.getVerticeVerticalIntersectPointWidthPlan=function(t,e){var i=t.clone(),r=e.clone(),o=i.x,s=i.y,l=i.z,u=new a.default(r.A,r.B,r.C);u.normalize();var c=u.x,h=u.y,f=u.z,p=r.D*c/r.A,d=-(c*o+h*s+f*l+p),v=d*c+o,y=d*h+s,g=d*f+l,m=new n.default(v,y,g);return m},t.getIntersectPointByLineAdPlan=function(t,e){var i=t.clone(),r=e.clone();i.vector.normalize();var o=r.A,a=r.B,s=r.C,l=r.D,u=i.vertice.x,c=i.vertice.y,h=i.vertice.z,f=i.vector.x,p=i.vector.y,d=i.vector.z,v=-(o*u+a*c+s*h+l)/(o*f+a*p+s*d),y=v*f+u,g=v*p+c,m=v*d+h,_=new n.default(y,g,m);return _},t.getLineIntersectPointWithEarth=function(t){var e=[],i=t.clone(),o=i.vertice,a=i.vector;a.normalize();var s=r.default.EARTH_RADIUS,l=a.x,u=a.y,c=a.z,h=o.x,f=o.y,p=o.z,d=l*l,v=u*u,y=c*c,g=s*s,m=l*f,_=l*p,b=u*h,w=u*p,L=c*h,T=c*f,x=m*b+_*L+w*T,M=m*m+_*_+b*b+w*w+L*L+T*T,R=d+v+y,P=8*x-4*M+4*g*R;if(P<0)e=[];else{var E=l*h+u*f+c*p,A=d+v+y;if(0==P){var C=-E/A,O=C*l+h,D=C*u+f,I=C*c+p,B=new n.default(O,D,I);e.push(B)}else if(P>0){var V=Math.sqrt(P),F=(-2*E+V)/(2*A),S=F*l+h,G=F*u+f,j=F*c+p,N=new n.default(S,G,j);e.push(N);var U=(-2*E-V)/(2*A),W=U*l+h,z=U*u+f,X=U*c+p,Y=new n.default(W,z,X);e.push(Y)}}return e},t.getCrossPlaneByLine=function(t,e){var i=t.clone(),r=e.clone();r.normalize();var o=r.x,n=r.y,a=r.z,s=i.x,u=i.y,c=i.z,h=-(o*s+n*u+a*c),f=new l.default(o,n,a,h);return f},t.convertPointFromCanvasToNDC=function(t,e,i,r){if(!o.default.isNumber(i))throw"invalid canvasX";if(!o.default.isNumber(r))throw"invalid canvasY";var n=2*i/t-1,a=1-2*r/e;return[n,a]},t.convertPointFromNdcToCanvas=function(t,e,i,r){if(!o.default.isNumber(i))throw"invalid ndcX";if(!o.default.isNumber(r))throw"invalid ndcY";var n=(1+i)*t/2,a=(1-r)*e/2;return[n,a]},t.geographicToCartesianCoord=function(t,e,i){if(void 0===i&&(i=r.default.EARTH_RADIUS),!(t>=-180.001&&t<=180.001))throw"invalid lon";if(!(e>=-90.001&&e<=90.001))throw"invalid lat";var o=this.degreeToRadian(t),a=this.degreeToRadian(e),s=Math.sin(o),l=Math.cos(o),u=Math.sin(a),c=Math.cos(a),h=i*s*c,f=i*u,p=i*l*c;return new n.default(h,f,p)},t.cartesianCoordToGeographic=function(t){var e=t.clone(),i=e.x,o=e.y,n=e.z,a=o/r.default.EARTH_RADIUS,s=this.asinSafely(a),l=Math.cos(s),u=i/(r.default.EARTH_RADIUS*l);u>1&&(u=1),u<-1&&(u=-1);var c=n/(r.default.EARTH_RADIUS*l);c>1&&(c=1),c<-1&&(c=-1);var h=this.asinSafely(u);h=u>=0?c>=0?h:Math.PI-h:c>=0?h:-h-Math.PI;var f=this.radianToDegree(s),p=this.radianToDegree(h);return[p,f]},t.degreeToRadian=function(t){return t*h},t.radianToDegree=function(t){return t*c},t.getRealArcDistanceBetweenLonLats=function(t,e,i,o){var n=this.degreeToRadian(e),a=this.degreeToRadian(o),s=a-n,l=this.degreeToRadian(i-t),u=Math.sin(s/2),c=Math.sin(l/2),h=u*u+Math.cos(n)*Math.cos(a)*c*c,f=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),p=r.default.REAL_EARTH_RADIUS*f;return p},t.webMercatorXToRadianLon=function(t){return t/r.default.EARTH_RADIUS},t.webMercatorXToDegreeLon=function(t){var e=this.webMercatorXToRadianLon(t);return this.radianToDegree(e)},t.webMercatorYToRadianLat=function(t){if(!o.default.isNumber(t))throw"invalid y";var e=t/r.default.EARTH_RADIUS,i=Math.pow(Math.E,e),n=Math.atan(i),a=2*n-Math.PI/2;return a},t.webMercatorYToDegreeLat=function(t){var e=this.webMercatorYToRadianLat(t);return this.radianToDegree(e)},t.webMercatorToRadianGeographic=function(t,e){var i=this.webMercatorXToRadianLon(t),r=this.webMercatorYToRadianLat(e);return[i,r]},t.webMercatorToDegreeGeographic=function(t,e){var i=this.webMercatorXToDegreeLon(t),r=this.webMercatorYToDegreeLat(e);return[i,r]},t.radianLonToWebMercatorX=function(t,e){if(void 0===e&&(e=!1),!(o.default.isNumber(t)&&t<=Math.PI+.001&&t>=-(Math.PI+.001)))throw"invalid radianLog";return e?r.default.REAL_EARTH_RADIUS*t:r.default.EARTH_RADIUS*t},t.degreeLonToWebMercatorX=function(t,e){if(void 0===e&&(e=!1),!(o.default.isNumber(t)&&t<=180.001&&t>=-180.001))throw"invalid degreeLog";var i=this.degreeToRadian(t);return this.radianLonToWebMercatorX(i,e)},t.radianLatToWebMercatorY=function(t,e){if(void 0===e&&(e=!1),!(t<=Math.PI/2+.001&&t>=-(Math.PI/2+.001)))throw"invalid radianLat";var i=Math.PI/4+t/2,o=Math.tan(i),n=Math.log(o);return e?r.default.REAL_EARTH_RADIUS*n:r.default.EARTH_RADIUS*n},t.degreeLatToWebMercatorY=function(t,e){if(void 0===e&&(e=!1),!(t<=90.001&&t>=-90.001))throw"invalid degreeLat";var i=this.degreeToRadian(t);return this.radianLatToWebMercatorY(i,e)},t.radianGeographicToWebMercator=function(t,e){var i=this.radianLonToWebMercatorX(t),r=this.radianLatToWebMercatorY(e);return[i,r]},t.degreeGeographicToWebMercator=function(t,e){var i=this.degreeLonToWebMercatorX(t),r=this.degreeLatToWebMercatorY(e);return[i,r]},t.getTileWebMercatorEnvelopeByGrid=function(t,e,i){var o=r.default.MAX_PROJECTED_COORD,n=2*o/Math.pow(2,t),a=-o+i*n,s=a+n,l=o-e*n,u=l-n,c={minX:a,minY:u,maxX:s,maxY:l};return c},t.getTileGeographicEnvelopByGrid=function(t,e,i){var r=this.getTileWebMercatorEnvelopeByGrid(t,e,i),o=this.webMercatorToDegreeGeographic(r.minX,r.minY),n=this.webMercatorToDegreeGeographic(r.maxX,r.maxY),a={minLon:o[0],minLat:o[1],maxLon:n[0],maxLat:n[1]};return a},t.getTileCartesianEnvelopByGrid=function(t,e,i){var r=this.getTileGeographicEnvelopByGrid(t,e,i),o=r.minLon,n=r.minLat,a=r.maxLon,s=r.maxLat,l=this.geographicToCartesianCoord(o,n),u=this.geographicToCartesianCoord(o,s),c=this.geographicToCartesianCoord(a,s),h=this.geographicToCartesianCoord(a,n),f={pLeftBottom:l,pLeftTop:u,pRightTop:c,pRightBottom:h,minLon:o,minLat:n,maxLon:a,maxLat:s};return f},t.getGeographicTileCenter=function(t,e,i){var r=this.getTileGeographicEnvelopByGrid(t,e,i),o=r.minLon,n=r.minLat,a=r.maxLon,s=r.maxLat,l=(o+a)/2,u=(n+s)/2,c=[l,u];return c},t.getCartesianTileCenter=function(t,e,i){var r=this.getGeographicTileCenter(t,e,i),o=this.geographicToCartesianCoord(r[0],r[1]);return o},t.calculateNormals=function(t,e){for(var i=0,r=1,o=2,n=[],a=0;a<t.length;a+=3)n[a+i]=0,n[a+r]=0,n[a+o]=0;for(var a=0;a<e.length;a+=3){var s=[],l=[],u=[];s[i]=t[3*e[a+2]+i]-t[3*e[a+1]+i],s[r]=t[3*e[a+2]+r]-t[3*e[a+1]+r],s[o]=t[3*e[a+2]+o]-t[3*e[a+1]+o],l[i]=t[3*e[a]+i]-t[3*e[a+1]+i],l[r]=t[3*e[a]+r]-t[3*e[a+1]+r],l[o]=t[3*e[a]+o]-t[3*e[a+1]+o],u[i]=s[r]*l[o]-s[o]*l[r],u[r]=s[o]*l[i]-s[i]*l[o],u[o]=s[i]*l[r]-s[r]*l[i];for(var c=0;c<3;c++)n[3*e[a+c]+i]=n[3*e[a+c]+i]+u[i],n[3*e[a+c]+r]=n[3*e[a+c]+r]+u[r],n[3*e[a+c]+o]=n[3*e[a+c]+o]+u[o]}for(var a=0;a<t.length;a+=3){var h=[];h[i]=n[a+i],h[r]=n[a+r],h[o]=n[a+o];var f=Math.sqrt(h[i]*h[i]+h[r]*h[r]+h[o]*h[o]);0==f&&(f=1),h[i]=h[i]/f,h[r]=h[r]/f,h[o]=h[o]/f,n[a+i]=h[i],n[a+r]=h[r],n[a+o]=h[o]}return n},t}();e.default=f},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i}return t.prototype.getArray=function(){return[this.x,this.y,this.z]},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.getOpposite=function(){return new t(-this.x,-this.y,-this.z)},t}();e.default=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(12),o=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i}return t.fromVertice=function(e){return new t(e.x,e.y,e.z)},t.verticeMinusVertice=function(e,i){return new t(e.x-i.x,e.y-i.y,e.z-i.z)},t.verticePlusVector=function(t,e){return new r.default(t.x+e.x,t.y+e.y,t.z+e.z)},t.getRadianOfTwoVectors=function(t,e){var i=t.clone().normalize(),r=e.clone().normalize(),o=i.dot(r);o<-1&&(o=-1),o>1&&(o=1);var n=Math.acos(o);return n},t.prototype.getVertice=function(){return new r.default(this.x,this.y,this.z)},t.prototype.getArray=function(){return[this.x,this.y,this.z]},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.getOpposite=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.normalize=function(){var t=this.getLength();return Math.abs(t)>=1e-6?(this.x/=t,this.y/=t,this.z/=t):(this.x=0,this.y=0,this.z=0),this},t.prototype.setLength=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this},t.prototype.getRandomVerticalVector=function(){var e,i=this.getLength();if(0===i)e=new t(0,0,0);else{var r,o,n;0!==this.x?(o=1,n=0,r=-this.y/this.x):0!==this.y?(n=1,r=0,o=-this.z/this.y):0!==this.z&&(r=1,o=0,n=-this.x/this.z),e=new t(r,o,n),e.normalize()}return e},t.prototype.cross=function(e){var i=this.y*e.z-this.z*e.y,r=this.z*e.x-this.x*e.z,o=this.x*e.y-this.y*e.x;return new t(i,r,o)},t.prototype.dot=function(e){if(!(e instanceof t))throw"invalid other";return this.x*e.x+this.y*e.y+this.z*e.z},t}();e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.vertice=t.clone(),this.vector=e.clone(),this.vector.normalize()}return t.prototype.setVertice=function(t){return this.vertice=t.clone(),this},t.prototype.setVector=function(t){return this.vector=t.clone(),this.vector.normalize(),this},t.prototype.clone=function(){var e=new t(this.vertice,this.vector);return e},t}();e.default=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,i,r){this.A=t,this.B=e,this.C=i,this.D=r}return t.prototype.clone=function(){var e=new t(this.A,this.B,this.C,this.D);return e},t}();e.default=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=i(5),n=i(11);!function(t){t[t.LEFT_TOP=0]="LEFT_TOP",t[t.RIGHT_TOP=1]="RIGHT_TOP",t[t.LEFT_BOTTOM=2]="LEFT_BOTTOM",t[t.RIGHT_BOTTOM=3]="RIGHT_BOTTOM",t[t.LEFT=4]="LEFT",t[t.RIGHT=5]="RIGHT",t[t.TOP=6]="TOP",t[t.BOTTOM=7]="BOTTOM"}(r=e.TileGridPosition||(e.TileGridPosition={}));var a=n.default.webMercatorYToDegreeLat(o.default.MAX_PROJECTED_COORD),s=function(){function t(t,e,i){this.level=t,this.row=e,this.column=i,this.Egeo=null}return t.prototype.equals=function(t){return t&&this.level===t.level&&this.row===t.row&&this.column===t.column},t.prototype.getEgeo=function(){return this.Egeo||(this.Egeo=n.default.getTileGeographicEnvelopByGrid(this.level,this.row,this.column)),this.Egeo},t.prototype.getLeftTopTag=function(){return this.level+"_"+this.row+"_"+this.column},t.prototype.getRightTopTag=function(){return this.level+"_"+this.row+"_"+(this.column+1)},t.prototype.getLeftBottomTag=function(){return this.level+"_"+(this.row+1)+"_"+this.column},t.prototype.getRightBottomTag=function(){return this.level+"_"+(this.row+1)+"_"+(this.column+1)},t.prototype.getLeft=function(){return t.getTileGridByBrother(this.level,this.row,this.column,r.LEFT)},t.prototype.getRight=function(){return t.getTileGridByBrother(this.level,this.row,this.column,r.RIGHT)},t.prototype.getTop=function(){return t.getTileGridByBrother(this.level,this.row,this.column,r.TOP)},t.prototype.getBottom=function(){return t.getTileGridByBrother(this.level,this.row,this.column,r.BOTTOM)},t.prototype.getParent=function(){return t.getTileGridAncestor(this.level-1,this.level,this.row,this.column)},t.prototype.getAncestor=function(e){return t.getTileGridAncestor(e,this.level,this.row,this.column)},t.getTileGridByParent=function(e,i,o,n){var a=e+1,s=-1,l=-1;if(n===r.LEFT_TOP)s=2*i,l=2*o;else if(n===r.RIGHT_TOP)s=2*i,l=2*o+1;else if(n===r.LEFT_BOTTOM)s=2*i+1,l=2*o;else{if(n!==r.RIGHT_BOTTOM)throw"invalid position";s=2*i+1,l=2*o+1}return new t(a,s,l)},t.getTilePositionOfParent=function(t,e,i,o){var n=null;o=o||this.getTileGridAncestor(t-1,t,e,i);var a=this.getTileGridByParent(o.level,o.row,o.column,r.LEFT_TOP);return a.row===e?a.column===i?n=r.LEFT_TOP:a.column+1===i&&(n=r.RIGHT_TOP):a.row+1===e&&(a.column===i?n=r.LEFT_BOTTOM:a.column+1===i&&(n=r.RIGHT_BOTTOM)),n},t.getTileGridByBrother=function(e,i,o,n,a){a=a||{};var s=new t(e,i,o);if(n===r.LEFT)if(0===o){var l=a.maxSize||Math.pow(2,e);s.column=l-1}else s.column=o-1;else if(n===r.RIGHT){var l=a.maxSize||Math.pow(2,e);o===l-1?s.column=0:s.column=o+1}else if(n===r.TOP)if(0===i){var l=a.maxSize||Math.pow(2,e);s.row=l-1}else s.row=i-1;else{if(n!==r.BOTTOM)throw"invalid position";var l=a.maxSize||Math.pow(2,e);i===l-1?s.row=0:s.row=i+1}return s},t.getTileGridAncestor=function(e,i,r,o){var n=null;if(e<i){var a=i-e,s=Math.pow(2,a),l=Math.floor(r/s),u=Math.floor(o/s);n=new t(e,l,u)}else e===i&&(n=new t(i,r,o));return n},t.isValidLatitude=function(t){return t>=-a&&t<=a},t.getTileGridByGeo=function(e,i,r){if(!(e>=-180&&e<=180))throw"invalid lon: "+e;var a=n.default.degreeGeographicToWebMercator(e,i),s=a[0],l=a[1],u=s+o.default.MAX_PROJECTED_COORD,c=o.default.MAX_PROJECTED_COORD-l,h=o.default.MAX_PROJECTED_COORD/Math.pow(2,r-1),f=Math.floor(c/h),p=Math.floor(u/h);return new t(r,f,p)},t}();e.default=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(7),o=i(12),n=i(13),a=function(){function t(t,e,i,r,o,n,a,s,l,u,c,h,f,p,d,v){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===n&&(n=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===l&&(l=0),void 0===u&&(u=0),void 0===c&&(c=1),void 0===h&&(h=0),void 0===f&&(f=0),void 0===p&&(p=0),void 0===d&&(d=0),void 0===v&&(v=1),this.elements=new Float64Array(16),this.setElements(t,e,i,r,o,n,a,s,l,u,c,h,f,p,d,v)}return t.prototype.getFloat32Array=function(){return new Float32Array(this.elements)},t.prototype.equals=function(t){return this===t||r.default.every(this.elements,function(e,i){return e===t.elements[i]})},t.prototype.toJson=function(){var t=[];return r.default.forEach(this.elements,function(e){t.push(e)}),{elements:t}},t.prototype.fromJson=function(t){var e=this;t.elements.forEach(function(t,i){e.elements[i]=t})},t.fromJson=function(e){if(!e)return null;var i=new t;return i.fromJson(e),i},t.prototype.setElements=function(t,e,i,r,o,n,a,s,l,u,c,h,f,p,d,v){var y=arguments.length;if(y<16)throw"invalid arguments:arguments length error";var g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=r,g[1]=o,g[5]=n,g[9]=a,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=f,g[7]=p,g[11]=d,g[15]=v,this},t.prototype.setVectorX=function(t){this.elements[0]=t.x,this.elements[1]=t.y,this.elements[2]=t.z},t.prototype.getVectorX=function(){return new n.default(this.elements[0],this.elements[1],this.elements[2])},t.prototype.setVectorY=function(t){this.elements[4]=t.x,this.elements[5]=t.y,this.elements[6]=t.z},t.prototype.getVectorY=function(){return new n.default(this.elements[4],this.elements[5],this.elements[6])},t.prototype.setVectorZ=function(t){this.elements[8]=t.x,this.elements[9]=t.y,this.elements[10]=t.z},t.prototype.getVectorZ=function(){return new n.default(this.elements[8],this.elements[9],this.elements[10])},t.prototype.setPosition=function(t){this.elements[12]=t.x,this.elements[13]=t.y,this.elements[14]=t.z},t.prototype.getPosition=function(){return new o.default(this.elements[12],this.elements[13],this.elements[14])},t.prototype.setLastRowDefault=function(){this.elements[3]=0,this.elements[7]=0,this.elements[11]=0,this.elements[15]=1},t.prototype.transpose=function(){var t=this.getTransposeMatrix();this.setMatrixByOther(t)},t.prototype.getTransposeMatrix=function(){var e=new t;return e.elements[0]=this.elements[0],e.elements[4]=this.elements[1],e.elements[8]=this.elements[2],e.elements[12]=this.elements[3],e.elements[1]=this.elements[4],e.elements[5]=this.elements[5],e.elements[9]=this.elements[6],e.elements[13]=this.elements[7],e.elements[2]=this.elements[8],e.elements[6]=this.elements[9],e.elements[10]=this.elements[10],e.elements[14]=this.elements[11],e.elements[3]=this.elements[12],e.elements[7]=this.elements[13],e.elements[11]=this.elements[14],e.elements[15]=this.elements[15],e},t.prototype.inverse=function(){var t=this.getInverseMatrix();this.setMatrixByOther(t)},t.prototype.getInverseMatrix=function(){var e=this.elements,i=new t,r=i.elements,o=e[0],n=e[1],a=e[2],s=e[3],l=e[4],u=e[5],c=e[6],h=e[7],f=e[8],p=e[9],d=e[10],v=e[11],y=e[12],g=e[13],m=e[14],_=e[15],b=o*u-n*l,w=o*c-a*l,L=o*h-s*l,T=n*c-a*u,x=n*h-s*u,M=a*h-s*c,R=f*g-p*y,P=f*m-d*y,E=f*_-v*y,A=p*m-d*g,C=p*_-v*g,O=d*_-v*m,D=b*O-w*C+L*A+T*E-x*P+M*R;return D?(D=1/D,r[0]=(u*O-c*C+h*A)*D,r[1]=(-n*O+a*C-s*A)*D,r[2]=(g*M-m*x+_*T)*D,r[3]=(-p*M+d*x-v*T)*D,r[4]=(-l*O+c*E-h*P)*D,r[5]=(o*O-a*E+s*P)*D,r[6]=(-y*M+m*L-_*w)*D,r[7]=(f*M-d*L+v*w)*D,r[8]=(l*C-u*E+h*R)*D,r[9]=(-o*C+n*E-s*R)*D,r[10]=(y*x-g*L+_*b)*D,r[11]=(-f*x+p*L-v*b)*D,r[12]=(-l*A+u*P-c*R)*D,r[13]=(o*A-n*P+a*R)*D,r[14]=(-y*T+g*w-m*b)*D,r[15]=(f*T-p*w+d*b)*D,i):(console.log("can't get inverse matrix"),null)},t.prototype.setMatrixByOther=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e]},t.prototype.setUnitMatrix=function(){this.setElements(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.prototype.setUniqueValue=function(t){for(var e=this.elements.length,i=0;i<e;i++)this.elements[i]=t},t.prototype.isUnitMatrix=function(){for(var t=this.elements,e=0;e<t.length;e++)if(e%4===0){if(1!=t[e])return!1}else if(0!==t[e])return!1;return!0},t.prototype.clone=function(){return new t(this.elements[0],this.elements[4],this.elements[8],this.elements[12],this.elements[1],this.elements[5],this.elements[9],this.elements[13],this.elements[2],this.elements[6],this.elements[10],this.elements[14],this.elements[3],this.elements[7],this.elements[11],this.elements[15])},t.prototype.multiplyMatrix=function(e){var i=this.elements,r=e.elements,o=i[0]*r[0]+i[4]*r[1]+i[8]*r[2]+i[12]*r[3],n=i[0]*r[4]+i[4]*r[5]+i[8]*r[6]+i[12]*r[7],a=i[0]*r[8]+i[4]*r[9]+i[8]*r[10]+i[12]*r[11],s=i[0]*r[12]+i[4]*r[13]+i[8]*r[14]+i[12]*r[15],l=i[1]*r[0]+i[5]*r[1]+i[9]*r[2]+i[13]*r[3],u=i[1]*r[4]+i[5]*r[5]+i[9]*r[6]+i[13]*r[7],c=i[1]*r[8]+i[5]*r[9]+i[9]*r[10]+i[13]*r[11],h=i[1]*r[12]+i[5]*r[13]+i[9]*r[14]+i[13]*r[15],f=i[2]*r[0]+i[6]*r[1]+i[10]*r[2]+i[14]*r[3],p=i[2]*r[4]+i[6]*r[5]+i[10]*r[6]+i[14]*r[7],d=i[2]*r[8]+i[6]*r[9]+i[10]*r[10]+i[14]*r[11],v=i[2]*r[12]+i[6]*r[13]+i[10]*r[14]+i[14]*r[15],y=i[3]*r[0]+i[7]*r[1]+i[11]*r[2]+i[15]*r[3],g=i[3]*r[4]+i[7]*r[5]+i[11]*r[6]+i[15]*r[7],m=i[3]*r[8]+i[7]*r[9]+i[11]*r[10]+i[15]*r[11],_=i[3]*r[12]+i[7]*r[13]+i[11]*r[14]+i[15]*r[15];return new t(o,n,a,s,l,u,c,h,f,p,d,v,y,g,m,_)},t.prototype.multiplyColumn=function(t){var e=4==t.length;if(!e)throw"invalid c";var i=this.elements,r=t,o=i[0]*r[0]+i[4]*r[1]+i[8]*r[2]+i[12]*r[3],n=i[1]*r[0]+i[5]*r[1]+i[9]*r[2]+i[13]*r[3],a=i[2]*r[0]+i[6]*r[1]+i[10]*r[2]+i[14]*r[3],s=i[3]*r[0]+i[7]*r[1]+i[11]*r[2]+i[15]*r[3];return[o,n,a,s]},t.prototype.hasNaN=function(){return r.default.some(this.elements,function(t){return isNaN(t)})},t.prototype.divide=function(t){if(0===t)throw"invalid a:a is 0";if(0!==t)for(var e=0,i=this.elements.length;e<i;e++)this.elements[e]/=t},t.prototype.worldTranslate=function(t,e,i){this.elements[12]+=t,this.elements[13]+=e,this.elements[14]+=i},t.prototype.localTranslate=function(t,e,i){var r=[t,e,i,1],o=this.multiplyColumn(r),n=this.getPosition();this.worldTranslate(o[0]-n.x,o[1]-n.y,o[2]-n.z)},t.prototype.worldScale=function(e,i,r){e=void 0!==e?e:1,i=void 0!==i?i:1,r=void 0!==r?r:1;var o=new t(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),n=o.multiplyMatrix(this);this.setMatrixByOther(n)},t.prototype.localScale=function(t,e,i){var r=this.getPosition();this.setPosition(new o.default(0,0,0)),this.worldScale(t,e,i),this.setPosition(r)},t.prototype.worldRotateX=function(e){var i=Math.cos(e),r=Math.sin(e),o=new t(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),n=o.multiplyMatrix(this);this.setMatrixByOther(n)},t.prototype.worldRotateY=function(e){var i=Math.cos(e),r=Math.sin(e),o=new t(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),n=o.multiplyMatrix(this);this.setMatrixByOther(n)},t.prototype.worldRotateZ=function(e){var i=Math.cos(e),r=Math.sin(e),o=new t(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),n=o.multiplyMatrix(this);this.setMatrixByOther(n)},t.prototype.worldRotateByVector=function(e,i){var r,o,n,a,s,l,u,c,h,f,p,d,v,y=i.x,g=i.y,m=i.z;o=Math.sin(e),n=Math.cos(e),r=Math.sqrt(y*y+g*g+m*m),y/=r,g/=r,m/=r,a=y*y,s=g*g,l=m*m,u=y*g,c=g*m,h=m*y,f=y*o,p=g*o,d=m*o,v=1-n;var _=v*a+n,b=v*u-d,w=v*h+p,L=0,T=v*u+d,x=v*s+n,M=v*c-f,R=0,P=v*h-p,E=v*c+f,A=v*l+n,C=0,O=0,D=0,I=0,B=1,V=new t(_,b,w,L,T,x,M,R,P,E,A,C,O,D,I,B),F=V.multiplyMatrix(this);this.setMatrixByOther(F)},t.prototype.localRotateX=function(t){var e=this.getPosition();this.setPosition(new o.default(0,0,0));var i=this.getVectorX();this.worldRotateByVector(t,i),this.setPosition(e)},t.prototype.localRotateY=function(t){var e=this.getPosition();this.setPosition(new o.default(0,0,0));
var i=this.getVectorY();this.worldRotateByVector(t,i),this.setPosition(e)},t.prototype.localRotateZ=function(t){var e=this.getPosition();this.setPosition(new o.default(0,0,0));var i=this.getVectorZ();this.worldRotateByVector(t,i),this.setPosition(e)},t.prototype.localRotateByVector=function(t,e){var i=e.getArray();i.push(1);var r=this.multiplyColumn(i),a=new n.default(r[0],r[1],r[2]),s=this.getPosition();this.setPosition(new o.default(0,0,0)),this.worldRotateByVector(t,a),this.setPosition(s)},t}();e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(17),o=function(){function t(){this.matrix=new r.default}return t.prototype.getMatrix=function(){return this.matrix},t.prototype.cloneMatrix=function(){return this.matrix.clone()},t.prototype.setVectorX=function(t){this.matrix.setVectorX(t)},t.prototype.getVectorX=function(){return this.matrix.getVectorX()},t.prototype.setVectorY=function(t){this.matrix.setVectorY(t)},t.prototype.getVectorY=function(){return this.matrix.getVectorY()},t.prototype.setVectorZ=function(t){this.matrix.setVectorZ(t)},t.prototype.getVectorZ=function(){return this.matrix.getVectorZ()},t.prototype.setPosition=function(t){this.matrix.setPosition(t)},t.prototype.getPosition=function(){return this.matrix.getPosition()},t.prototype.worldTranslate=function(t,e,i){this.matrix.worldTranslate(t,e,i)},t.prototype.localTranslate=function(t,e,i){this.matrix.localTranslate(t,e,i)},t.prototype.worldScale=function(t,e,i){this.matrix.worldScale(t,e,i)},t.prototype.localScale=function(t,e,i){this.matrix.localScale(t,e,i)},t.prototype.worldRotateX=function(t){this.matrix.worldRotateX(t)},t.prototype.worldRotateY=function(t){this.matrix.worldRotateY(t)},t.prototype.worldRotateZ=function(t){this.matrix.worldRotateZ(t)},t.prototype.worldRotateByVector=function(t,e){this.matrix.worldRotateByVector(t,e)},t.prototype.localRotateX=function(t){this.matrix.localRotateX(t)},t.prototype.localRotateY=function(t){this.matrix.localRotateY(t)},t.prototype.localRotateZ=function(t){this.matrix.localRotateZ(t)},t.prototype.localRotateByVector=function(t,e){this.matrix.localRotateByVector(t,e)},t.prototype.getXAxisDirection=function(){var t=this.matrix.getVectorX();return t.normalize(),t},t.prototype.getYAxisDirection=function(){var t=this.matrix.getVectorY();return t.normalize(),t},t.prototype.getZAxisDirection=function(){var t=this.matrix.getVectorZ();return t.normalize(),t},t}();e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,i,r){this.minLon=t,this.minLat=e,this.maxLon=i,this.maxLat=r}return t.prototype.clone=function(){return new t(this.minLon,this.minLat,this.maxLon,this.maxLat)},t.prototype.getMinLon=function(){return this.minLon},t.prototype.getMinLat=function(){return this.minLat},t.prototype.getMaxLon=function(){return this.maxLon},t.prototype.getMaxLat=function(){return this.maxLat},t.prototype.toJson=function(){return[this.minLon,this.minLat,this.maxLon,this.maxLat]},t.merge=function(e,i){var r=null;if(1===e.length)r=e[0].clone();else if(e.length>1){var o=[],n=[],a=[],s=[];if(e.forEach(function(t){o.push(t.getMinLon()),n.push(t.getMinLat()),a.push(t.getMaxLon()),s.push(t.getMaxLat())}),i){var l=Math.min.apply(Math,o),u=Math.min.apply(Math,n),c=Math.max.apply(Math,a),h=Math.max.apply(Math,s);r=new t(l,u,c,h)}else{var l=Math.max.apply(Math,o),u=Math.max.apply(Math,n),c=Math.min.apply(Math,a),h=Math.min.apply(Math,s);l<c&&u<h&&(r=new t(l,u,c,h))}}return r},t.union=function(t){return this.merge(t,!0)},t.intersect=function(t){return this.merge(t,!1)},t}();e.default=i},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(21),n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e}(o.default);e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),o=function(){function t(){this.visible=!0,this.id=++r.default.idCounter,this.children=[]}return t.prototype.add=function(t,e){void 0===e&&(e=!1),e?this.children.unshift(t):this.children.push(t),t.parent=this},t.prototype.remove=function(t){var e=!1,i=this.findGraphicById(t.id);return i&&(t.destroy(),this.children.splice(i.index,1),t=null,e=!0),e},t.prototype.clear=function(){for(var t=0,e=this.children.length,i=null;t<e;t++)i=this.children[t],i.destroy();this.children=[]},t.prototype.destroy=function(){this.parent=null,this.clear()},t.prototype.findGraphicById=function(t){for(var e=0,i=this.children.length,r=null;e<i;e++)if(r=this.children[e],r.id===t)return{index:e,graphic:r};return null},t.prototype.shouldDraw=function(){return this.visible&&this.children.length>0},t.prototype.draw=function(t){this.shouldDraw()&&this.onDraw(t)},t.prototype.onDraw=function(t){this.children.forEach(function(e){e.shouldDraw(t)&&e.draw(t)})},t}();e.default=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={MAX_LEVEL:4,images:{},add:function(t,e){this.images[t]=e},get:function(t){return this.images[t]},remove:function(t){delete this.images[t]},clear:function(){this.images={}},getCount:function(){var t=0;for(var e in this.images)this.images.hasOwnProperty(e)&&t++;return t}};e.default=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(7),o=i(11),n=i(13),a=function(){function t(t){this.globe=t,this.down=!1,this.dragGeo=null,this.previousX=-1,this.previousY=-1,this.twoTouchDistance=-1,this.oldTime=-1,this.lastTime=-1,this.startTime=-1,this.endTime=-1,this.resizeListener=null,this.bodyKeydownListener=null,this.endTime=this.startTime=this.lastTime=this.oldTime=Date.now(),this._bindEvents()}return t.prototype.destroy=function(){var t=this;this.globe=null;var e=["touchstart","touchend","touchmove","mousedown","mouseup","mousemove","dblclick","mousewheel","DOMMouseScroll"];e.forEach(function(e){t.globe.canvas.removeEventListener(e)}),this.bodyKeydownListener&&document.body.removeEventListener("keydown",this.bodyKeydownListener),this.bodyKeydownListener=null},t.prototype._bindEvents=function(){r.default.isMobile()?(this.globe.canvas.addEventListener("touchstart",this._onTouchStart.bind(this),!1),this.globe.canvas.addEventListener("touchend",this._onTouchEnd.bind(this),!1),this.globe.canvas.addEventListener("touchmove",this._onTouchMove.bind(this),!1)):(this.globe.canvas.addEventListener("mousedown",this._onMouseDown.bind(this),!1),this.globe.canvas.addEventListener("mouseup",this._onMouseUp.bind(this),!1),this.globe.canvas.addEventListener("mousemove",this._onMouseMove.bind(this),!1),this.globe.canvas.addEventListener("dblclick",this._onDbClick.bind(this),!1),this.globe.canvas.addEventListener("mousewheel",this._onMouseWheel.bind(this),!1),this.globe.canvas.addEventListener("DOMMouseScroll",this._onMouseWheel.bind(this),!1),this.bodyKeydownListener=this._onKeyDown.bind(this),document.body.addEventListener("keydown",this.bodyKeydownListener,!1))},t.prototype.moveLonLatToCanvas=function(t,e,i,r){var n=this.globe.camera.getPickCartesianCoordInEarthByCanvas(i,r);if(n.length>0){var a=o.default.cartesianCoordToGeographic(n[0]),s=a[0],l=a[1];this._moveGeo(t,e,s,l)}},t.prototype._moveGeo=function(t,e,i,r){if(t!==i||e!==r){var a=o.default.geographicToCartesianCoord(t,e),s=n.default.fromVertice(a),l=o.default.geographicToCartesianCoord(i,r),u=n.default.fromVertice(l),c=s.cross(u),h=-n.default.getRadianOfTwoVectors(s,u);this.globe.camera.worldRotateByVector(h,c)}},t.prototype._handleMouseDownOrTouchStart=function(t,e){this.down=!0,this.previousX=t,this.previousY=e;var i=this.globe.camera.getPickCartesianCoordInEarthByCanvas(this.previousX,this.previousY);i.length>0&&(this.dragGeo=o.default.cartesianCoordToGeographic(i[0]))},t.prototype._handleMouseMoveOrTouchMove=function(t,e){var i=this.globe;if(i&&!i.isAnimating()&&this.down){var r=i.camera.getPickCartesianCoordInEarthByCanvas(t,e);if(r.length>0){if(this.dragGeo){var n=o.default.cartesianCoordToGeographic(r[0]);this._moveGeo(this.dragGeo[0],this.dragGeo[1],n[0],n[1])}else this.dragGeo=o.default.cartesianCoordToGeographic(r[0]);this.previousX=t,this.previousY=e,this.globe.canvas.style.cursor="pointer"}else this.previousX=-1,this.previousY=-1,this.dragGeo=null,this.globe.canvas.style.cursor="default"}},t.prototype._handleMouseUpOrTouchEnd=function(){this.down=!1,this.previousX=-1,this.previousY=-1,this.dragGeo=null,this.globe.canvas&&(this.globe.canvas.style.cursor="default"),r.default.publish("extent-change")},t.prototype._onMouseDown=function(t){var e=this.globe;if(e&&!e.isAnimating()){var i=t.layerX||t.offsetX,r=t.layerY||t.offsetY;this._handleMouseDownOrTouchStart(i,r)}},t.prototype._onMouseMove=function(t){if(this.down&&!this.globe.isAnimating()){var e=t.layerX||t.offsetX,i=t.layerY||t.offsetY;this._handleMouseMoveOrTouchMove(e,i)}},t.prototype._onMouseUp=function(){this._handleMouseUpOrTouchEnd()},t.prototype._onDbClick=function(t){var e=this.globe;if(e&&!e.isAnimating()){var i=t.layerX||t.offsetX,r=t.layerY||t.offsetY,n=e.camera.getPickCartesianCoordInEarthByCanvas(i,r);if(e.zoomIn(),n.length>=1){var a=n[0],s=o.default.cartesianCoordToGeographic(a),l=s[0],u=s[1];e.zoomIn(),this.moveLonLatToCanvas(l,u,i,r)}}},t.prototype._onMouseWheel=function(t){var e=this.globe;if(e&&!e.isAnimating()){var i,o=0;t.wheelDelta?(i=t.wheelDelta,o=parseInt(i/120)):t.detail&&(i=t.detail,o=-parseInt(i/3));var n=e.getLevel()+o;n>=0&&e.animateToLevel(n,function(){r.default.publish("extent-change")})}},t.prototype._onKeyDown=function(t){var e=this.globe;if(e&&!e.isAnimating()){var i=2,r=e.camera,o=void 0!==t.keyCode?t.keyCode:t.which;38===o?r.setDeltaPitch(i):40===o&&r.setDeltaPitch(-i)}},t.prototype._onTouchZero=function(){this.twoTouchDistance=-1,this._handleMouseUpOrTouchEnd(),this.endTime=Date.now();var t=this.endTime-this.startTime;if(t<=200){var e=this.endTime-this.lastTime;e<300?(this.lastTime=this.oldTime,this.globe.zoomIn()):this.lastTime=this.endTime}},t.prototype._onTouchOne=function(t){this.twoTouchDistance=-1;var e=t.targetTouches[0],i=e.pageX,r=e.pageY;this._handleMouseDownOrTouchStart(i,r),this.startTime=Date.now()},t.prototype._onTouchTwo=function(t){this.down=!0,this.previousX=-1,this.previousY=-1,this.dragGeo=null;var e=t.targetTouches[0],i=e.pageX,r=e.pageY,o=t.targetTouches[1],n=o.pageX,a=o.pageY;this.twoTouchDistance=Math.sqrt((i-n)*(i-n)+(r-a)*(r-a))},t.prototype._onTouchMulti=function(){this.down=!0,this.previousX=-1,this.previousY=-1,this.dragGeo=null,this.twoTouchDistance=-1},t.prototype._onTouchStart=function(t){var e=this.globe;if(e&&!e.isAnimating()){var i=t.targetTouches.length;0===i?this._onTouchZero():1===i?this._onTouchOne(t):2===i?this._onTouchTwo(t):this._onTouchMulti()}},t.prototype._onTouchMoveOne=function(t){var e=t.targetTouches[0],i=e.pageX,r=e.pageY;this._handleMouseMoveOrTouchMove(i,r)},t.prototype._onTouchMoveTwo=function(t){var e=this,i=t.targetTouches[0],r=i.pageX,o=i.pageY,n=t.targetTouches[1],a=n.pageX,s=n.pageY,l=Math.sqrt((r-a)*(r-a)+(o-s)*(o-s)),u=l/this.twoTouchDistance;u>=1.3?this.globe.animateIn(function(){e.twoTouchDistance=l}):u<=.7&&this.globe.animateOut(function(){e.twoTouchDistance=l})},t.prototype._onTouchMove=function(t){if(t.preventDefault(),this.down&&!this.globe.isAnimating()){var e=t.targetTouches.length;1===e?this._onTouchMoveOne(t):2===e&&this._onTouchMoveTwo(t)}},t.prototype._onTouchEnd=function(t){var e=t.targetTouches.length;0===e?this._onTouchZero():1===e?this._onTouchOne(t):2===e?this._onTouchTwo(t):this._onTouchMulti()},t}();e.default=a},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(25),n=i(39),a=function(t){function e(e){void 0===e&&(e="Default");var i=t.call(this,e)||this;return i.idx=0,i}return r(e,t),e.prototype.getTileUrl=function(t,e,i){void 0===this.idx&&(this.idx=0);var r="y";switch(this.style){case"Satellite":r="s";break;case"Road":r="m";break;case"RoadOnly":r="h";break;case"Terrain":r="p";break;case"TerrainOnly":r="t"}var o="//mt"+this.idx+".google.cn/maps/vt?lyrs="+r+"&hl=zh-CN&gl=CN&&x="+i+"&y="+e+"&z="+t;return this.idx++,this.idx>=4&&(this.idx=0),o},e}(o.default);e.GoogleTiledLayer=a;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.idx=0,e}return r(e,t),e.prototype.getTileUrl=function(t,e,i){void 0===this.idx&&(this.idx=0);var r="//mt"+this.idx+".google.cn/vt/imgtp=png32&lyrs=h@365000000&hl=zh-CN&gl=cn&x="+i+"&y="+e+"&z="+t+"&s=Galil";return this.idx++,this.idx>=4&&(this.idx=0),r},e}(n.default);e.GoogleLabelLayer=s},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(7),n=i(26),a=i(21),s=i(38),l=function(t){function e(e){void 0===e&&(e="");var i=t.call(this)||this;i.style=e,i.imageRequestOptimizeDeltaLevel=2,i.globe=null;var r=new s.default(0);i.add(r);var o=new s.default(1);i.add(o);for(var a=0;a<=1;a++)for(var l=0;l<=1;l++){var u={level:1,row:a,column:l,url:""};u.url=i.getTileUrl(u.level,u.row,u.column);var c=n.default.getInstance(u.level,u.row,u.column,u.url);o.add(c)}return i}return r(e,t),e.prototype.destroy=function(){this.globe=null,t.prototype.destroy.call(this)},e.prototype.refresh=function(){if(this.globe){var t=this.globe.camera,e=this.globe.getLevel(),i={threshold:1};i.threshold=1;var r,n=t.getVisibleTilesByLevel(e,i),a=[],s=n;for(r=e;r>=2;r--)a[r]=s,s=s.map(function(t){return t.getParent()}),s=o.default.filterRepeatArray(s);for(r=2;r<=e;r++){var l=e===r||e-r>this.imageRequestOptimizeDeltaLevel;this.children[r].updateTiles(r,a[r],l)}}},e.prototype.updateSubLayerCount=function(){if(this.globe){var t,e,i=this.globe.getLevel(),r=this.children.length,o=i+1-r;if(o>0)for(t=0;t<o;t++)e=new s.default(t+r),this.add(e);else if(o<0)for(o*=-1,t=0;t<o;t++){var n=this.children.length-1;if(!(n>=2))break;e=this.children[n],this.remove(e)}}},e.prototype._getReadyTile=function(t){var e=t.level,i=t.row,r=t.column,o=this.children[e].findTile(e,i,r);return 1===e?o:o&&o.isReady()?o:this._getReadyTile(t.getParent())},e.prototype.updateTileVisibility=function(){var t=this;if(this.globe){var e=this.globe.getLevel();this.children.forEach(function(t){t.showAllTiles()});var i=e-this.imageRequestOptimizeDeltaLevel-1;if(i>=1){var r=this.globe.camera,n=r.getTileGridsOfBoundary(i,!1);if(8===n.length){n=o.default.filterRepeatArray(n);for(var a=0;a<=i;a++)this.children[a].hideAllTiles();n.forEach(function(e){var i=t._getReadyTile(e);i&&(i.setVisible(!0),i.parent.visible=!0)})}}}},e.prototype.onDraw=function(e){var i=this.globe&&this.globe.gl;if(i){var r=n.default.findProgram();if(r){r.use();var o=e.getProjViewMatrixForDraw(),a=r.getUniformLocation("uPMVMatrix");i.uniformMatrix4fv(a,!1,o.getFloat32Array()),i.activeTexture(WebGLRenderingContext.TEXTURE0);var s=r.getUniformLocation("uSampler");i.uniform1i(s,0),i.depthFunc(WebGLRenderingContext.ALWAYS),t.prototype.onDraw.call(this,e),i.depthFunc(WebGLRenderingContext.LEQUAL)}}},e.prototype.getExtent=function(){var t=this.children[this.children.length-1];return t.getExtent()},e.prototype.wrapUrlWithProxy=function(t){return o.default.wrapUrlWithProxy(t)},e.prototype.getLastLevelVisibleTileGrids=function(){var t=null,e=this.children[this.children.length-1];return e&&(t=e.getVisibleTileGrids()),t},e.prototype.logVisibleTiles=function(){var t=[];this.children.forEach(function(e){var i=e.children.length,r=e.getShouldDrawTilesCount();t.push({level:e.getLevel(),allCount:i,visibleCount:r})}),console.table(t)},e}(a.default);e.default=l},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(19),a=i(11),s=i(27),l=i(30),u=i(33),c=i(37),h=i(35),f=i(16),p=function(){function t(t,e,i,r){this.level=t,this.row=e,this.column=i,this.url=r,this.minLon=null,this.minLat=null,this.maxLon=null,this.maxLat=null,this.minX=null,this.minY=null,this.maxX=null,this.maxY=null,this.segment=1,this._setTileInfo(),this._handleGlobeTile(),this.material=new l.default(this.level,this.url)}return t.prototype._setTileInfo=function(){var t=a.default.getTileGeographicEnvelopByGrid(this.level,this.row,this.column);this.minLon=t.minLon,this.minLat=t.minLat,this.maxLon=t.maxLon,this.maxLat=t.maxLat;var e=a.default.degreeGeographicToWebMercator(this.minLon,this.minLat),i=a.default.degreeGeographicToWebMercator(this.maxLon,this.maxLat);this.minX=e[0],this.minY=e[1],this.maxX=i[0],this.maxY=i[1]},t.prototype._handleGlobeTile=function(){var t=o.default.BASE_LEVEL;if(this.level<t){var e=t-this.level;this.segment=Math.pow(2,e)}else this.segment=1;this._handleTile()},t.prototype._handleTile=function(){this.visible=!0;var t,e,i=[],r=[],n=[],s=[],l=[],f=(this.maxX-this.minX)/this.segment,p=(this.maxY-this.minY)/this.segment,d=1/this.segment,v=0,y=[],g=[],m=[],_=[];for(t=0;t<=this.segment;t++){y.push(this.minX+t*f),g.push(this.maxY-t*p);var b=t*d;m.push(b),_.push(1-b)}var w=0;for(t=0;t<=this.segment;t++)for(e=0;e<=this.segment;e++){var L=y[e],T=g[t],x=0,M=a.default.webMercatorToDegreeGeographic(L,T),R=a.default.geographicToCartesianCoord(M[0],M[1],o.default.EARTH_RADIUS+x+v).getArray();n=n.concat(R),l=l.concat(m[e],_[t]);var P=new c.default({p:R,i:w,uv:[m[e],_[t]]});i.push(P),w++}for(t=0;t<this.segment;t++)for(e=0;e<this.segment;e++){var E=(this.segment+1)*t+e,A=(this.segment+1)*(t+1)+e,C=A+1,O=E+1;s=s.concat(E,A,C),s=s.concat(C,O,E);var D=i[E],I=i[A],B=i[C],V=i[O],F=new h.default(D,I,B),S=new h.default(B,V,D);r.push(F,S)}this.geometry=new u.default(i,r)},t}(),d=function(t){function e(e,i,r){var o=t.call(this,e,i)||this;return o.geometry=e,o.material=i,o.tileInfo=r,o}return r(e,t),e.getInstance=function(t,i,r,o){var n=new p(t,i,r,o);return new e(n.geometry,n.material,n)},e.prototype.updateShaderUniforms=function(t){},e.prototype.getExtent=function(){var t=this.tileInfo;new f.default(t.level,t.row,t.column);return new n.default(this.tileInfo.minLon,this.tileInfo.minLat,this.tileInfo.maxLon,this.tileInfo.maxLat)},e.prototype.shouldDraw=function(e){return this.tileInfo.visible&&t.prototype.shouldDraw.call(this,e)},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.subTiledLayer=null},e}(s.default);e.default=d},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(28),a=i(29),s="\nattribute vec3 aPosition;\nattribute vec2 aUV;\nvarying vec2 vUV;\nuniform mat4 uPMVMatrix;\n\nvoid main()\n{\n\tgl_Position = uPMVMatrix * vec4(aPosition,1.0);\n\tvUV = aUV;\n}\n",l="\nprecision mediump float;\nvarying vec2 vUV;\nuniform sampler2D uSampler;\n\nvoid main()\n{\n\tgl_FragColor = texture2D(uSampler, vec2(vUV.s, vUV.t));\n}\n",u=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.geometry=e,r.material=i,r.geometry.calculateVBO(),r.geometry.calculateIBO(),r.geometry.calculateUVBO(),r}return r(e,t),e.prototype.isGeometryReady=function(){return!!this.geometry.vbo&&!!this.geometry.ibo&&!!this.geometry.uvbo},e.prototype.isReady=function(){return this.isGeometryReady()&&t.prototype.isReady.call(this)},e.findProgram=function(){return n.default.findProgram(s,l)},e.prototype.createProgram=function(){return n.default.getProgram(s,l)},e.prototype.updateShaderUniforms=function(t){var e=o.default.gl,i=t.getProjViewMatrixForDraw().multiplyMatrix(this.geometry.getMatrix()),r=this.program.getUniformLocation("uPMVMatrix");e.uniformMatrix4fv(r,!1,i.getFloat32Array()),e.activeTexture(WebGLRenderingContext.TEXTURE0);var n=this.program.getUniformLocation("uSampler");e.uniform1i(n,0)},e.prototype.onDraw=function(t){var e=o.default.gl;this.updateShaderUniforms(t);var i=this.program.getAttribLocation("aPosition");this.program.enableVertexAttribArray("aPosition"),this.geometry.vbo.bind(),e.vertexAttribPointer(i,3,WebGLRenderingContext.FLOAT,!1,0,0);var r=this.program.getAttribLocation("aUV");this.program.enableVertexAttribArray("aUV"),this.geometry.uvbo.bind(),e.vertexAttribPointer(r,2,WebGLRenderingContext.FLOAT,!1,0,0),e.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.material.texture),this.geometry.ibo.bind();var n=3*this.geometry.triangles.length;e.drawElements(WebGLRenderingContext.TRIANGLES,n,WebGLRenderingContext.UNSIGNED_SHORT,0)},e}(a.default);e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),o=function(){function t(t,e){this.vs=t,this.fs=e,this.ready=!1,this.activeInfosObject={},this._init()}return t.getProgram=function(e,i){var r=t.findProgram(e,i);return r||(r=new t(e,i),t.programs.push(r)),r},t.findProgram=function(e,i){var r=null;return t.programs.some(function(t){return t.vs===e&&t.fs===i&&(r=t,!0)}),r},t.prototype.use=function(){this.ready&&t.currentProgram!==this&&(r.default.gl.useProgram(this.program),t.currentProgram=this)},t.prototype.updateActiveAttribInfos=function(){for(var t,e=r.default.gl.getProgramParameter(this.program,WebGLRenderingContext.ACTIVE_ATTRIBUTES),i=0;i<e;i++)t=r.default.gl.getActiveAttrib(this.program,i),t.loc=r.default.gl.getAttribLocation(this.program,t.name),t.isAttribute=!0,this.activeInfosObject[t.name]=t},t.prototype.updateActiveUniformInfos=function(){for(var t,e=r.default.gl.getProgramParameter(this.program,WebGLRenderingContext.ACTIVE_UNIFORMS),i=0;i<e;i++)t=r.default.gl.getActiveUniform(this.program,i),t.loc=r.default.gl.getUniformLocation(this.program,t.name),t.isAttribute=!1,this.activeInfosObject[t.name]=t},t.prototype.getLocation=function(t){var e=-1,i=this.activeInfosObject[t];return i&&(e=i.loc),e},t.prototype.getAttribLocation=function(t){var e=-1,i=this.activeInfosObject[t];return i&&i.isAttribute&&(e=i.loc),e},t.prototype.getUniformLocation=function(t){var e,i=this.activeInfosObject[t];return i&&!i.isAttribute&&(e=i.loc),e},t.prototype.getVertexAttrib=function(){},t.prototype.getUniform=function(t){var e,i=this.getUniformLocation(t);return i&&(e=r.default.gl.getUniform(this.program,i)),e},t.prototype.enableVertexAttribArray=function(t){var e=this.activeInfosObject[t];if(e&&e.isAttribute&&e.isEnabled!==!0){var i=e.loc;r.default.gl.enableVertexAttribArray(i),e.isEnabled=!0}},t.prototype.disableVertexAttribArray=function(t){var e=this.activeInfosObject[t];if(e&&e.isAttribute&&e.isEnabled!==!1){var i=e.loc;r.default.gl.disableVertexAttribArray(i),e.isEnabled=!1}},t.prototype._init=function(){var t=this._getShader(WebGLRenderingContext.VERTEX_SHADER,this.vs);if(t){var e=this._getShader(WebGLRenderingContext.FRAGMENT_SHADER,this.fs);if(e){if(this.program=r.default.gl.createProgram(),r.default.gl.attachShader(this.program,t),r.default.gl.attachShader(this.program,e),r.default.gl.linkProgram(this.program),!r.default.gl.getProgramParameter(this.program,WebGLRenderingContext.LINK_STATUS))return console.error("Could not link program!"),r.default.gl.deleteProgram(this.program),r.default.gl.deleteShader(t),r.default.gl.deleteShader(e),void(this.program=null);this.updateActiveAttribInfos(),this.updateActiveUniformInfos(),this.ready=!0}}},t.prototype._getShader=function(t,e){var i=r.default.gl.createShader(t);return r.default.gl.shaderSource(i,e),r.default.gl.compileShader(i),r.default.gl.getShaderParameter(i,WebGLRenderingContext.COMPILE_STATUS)?i:(console.error("create shader failed",r.default.gl.getShaderInfoLog(i)),r.default.gl.deleteShader(i),null)},t}();o.programs=[],e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),o=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.geometry=t,this.material=e,this.visible=!0,this.id=++r.default.idCounter,this.parent=null,this.program=this.createProgram()}return t.prototype.setVisible=function(t){this.visible=t},t.prototype.isReady=function(){return!!(this.geometry&&this.material&&this.material.isReady())},t.prototype.shouldDraw=function(t){return this.visible&&this.isReady()},t.prototype.draw=function(t){this.shouldDraw(t)&&(this.program.use(),this.onDraw(t))},t.prototype.destroy=function(){this.parent=null,this.geometry&&this.geometry.destroy(),this.material&&this.material.destroy(),this.geometry=null,this.material=null},t}();e.default=o},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(31),n=i(22),a=function(t){function e(e,i){var r=t.call(this,i,!0)||this;return r.level=e>=0?e:20,r}return r(e,t),e.prototype.onLoad=function(){this.level<=n.default.MAX_LEVEL&&n.default.add(this.image.src,this.image),t.prototype.onLoad.call(this)},e}(o.default);e.default=a},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(32),a=i(22),s=function(t){function e(e,i){void 0===e&&(e=null),void 0===i&&(i=!1);var r=t.call(this)||this;return r.flipY=i,r.ready=!1,r.deleted=!1,r.texture=o.default.gl.createTexture(),e&&r.setImageOrUrl(e),r}return r(e,t),e.prototype.isReady=function(){return this.ready&&!this.deleted},e.prototype.setImageOrUrl=function(t){t&&(t instanceof Image&&t.width>0&&t.height>0?this.setImage(t):"string"==typeof t&&this.setImageUrl(t))},e.prototype.setImage=function(t){t.width>0&&t.height>0&&(this.ready=!1,this.image=t,this.onLoad())},e.prototype.setImageUrl=function(t){var e=a.default.get(t);e?this.setImage(e):(this.ready=!1,this.image=new Image,this.image.crossOrigin="anonymous",this.image.onload=this.onLoad.bind(this),this.image.src=t)},e.prototype.onLoad=function(){if(!this.deleted){var t=o.default.gl;t.bindTexture(t.TEXTURE_2D,this.texture),this.flipY?t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1):t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.image),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.ready=!0}},e.prototype.destroy=function(){var t=o.default.gl;this.texture&&t.deleteTexture(this.texture),this.image&&!this.ready&&(this.image.src=""),this.ready=!1,this.texture=null,this.deleted=!0},e}(n.default);e.default=s},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t}();e.default=i},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(34),n=function(t){function e(e,i){var r=t.call(this)||this;return r.vertices=e,r.triangles=i,r}return r(e,t),e}(o.default);e.default=n},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(35),n=i(18),a=i(36),s=function(t){function e(){var e=t.call(this)||this;return e.vertices=null,e.triangles=null,e.vbo=null,e.ibo=null,e.nbo=null,e.uvbo=null,e.cbo=null,e.vertices=[],e.triangles=[],e}return r(e,t),e.buildPlane=function(t,e,i,r){var n=new o.default(t,e,i),a=new o.default(i,e,r);return[n,a]},e.prototype.buildTriangles=function(){this.vertices=[],this.triangles=[]},e.prototype.calculateVBO=function(t){if(void 0===t&&(t=!1),!this.vbo||t){for(var e,i=[],r=0,o=this.vertices.length;r<o;r++)e=this.vertices[r],i.push(e.p[0]),i.push(e.p[1]),i.push(e.p[2]);this.vbo||(this.vbo=new a.default(WebGLRenderingContext.ARRAY_BUFFER)),this.vbo.bind(),this.vbo.bufferData(i,WebGLRenderingContext.STATIC_DRAW,!0)}return this.vbo},e.prototype.calculateIBO=function(t){if(void 0===t&&(t=!1),!this.ibo||t){for(var e,i=[],r=0,o=this.triangles.length;r<o;r++)e=this.triangles[r],i.push(e.v1.i),i.push(e.v2.i),i.push(e.v3.i);this.ibo||(this.ibo=new a.default(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER)),this.ibo.bind(),this.ibo.bufferData(i,WebGLRenderingContext.STATIC_DRAW,!0)}return this.ibo},e.prototype.calculateNBO=function(t){if(void 0===t&&(t=!1),!this.nbo||t){for(var e,i=[],r=0,o=this.vertices.length;r<o;r++)e=this.vertices[r],i.push(e.n[0]),i.push(e.n[1]),i.push(e.n[2]);this.nbo||(this.nbo=new a.default(WebGLRenderingContext.ARRAY_BUFFER)),this.nbo.bind(),this.nbo.bufferData(i,WebGLRenderingContext.STATIC_DRAW,!0)}return this.nbo},e.prototype.calculateUVBO=function(t){if(void 0===t&&(t=!1),!this.uvbo||t){for(var e,i=[],r=0,o=this.vertices.length;r<o;r++)e=this.vertices[r],i.push(e.uv[0]),i.push(e.uv[1]);this.uvbo||(this.uvbo=new a.default(WebGLRenderingContext.ARRAY_BUFFER)),this.uvbo.bind(),this.uvbo.bufferData(i,WebGLRenderingContext.STATIC_DRAW,!0)}return this.uvbo},e.prototype.calculateCBO=function(t){if(void 0===t&&(t=!1),!this.cbo||t){for(var e,i=[],r=0,o=this.vertices.length;r<o;r++)e=this.vertices[r],i.push(e.c[0]),i.push(e.c[1]),i.push(e.c[2]);this.cbo||(this.cbo=new a.default(WebGLRenderingContext.ARRAY_BUFFER)),this.cbo.bind(),this.cbo.bufferData(i,WebGLRenderingContext.STATIC_DRAW,!0)}return this.cbo},e.prototype.destroy=function(){this.vbo&&this.vbo.destroy(),this.ibo&&this.ibo.destroy(),this.nbo&&this.nbo.destroy(),this.cbo&&this.cbo.destroy(),this.uvbo&&this.uvbo.destroy(),this.vbo=null,this.ibo=null,this.nbo=null,this.cbo=null,this.uvbo=null,this.vertices=[],this.triangles=[]},e}(n.default);e.default=s},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,i){this.v1=t,this.v2=e,this.v3=i}return t.prototype.setColor=function(t){this.v1.c=this.v2.c=this.v3.c=t},t.assembleQuad=function(e,i,r,o){return[new t(e,i,r),new t(r,i,o)];
},t}();e.default=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(5),o=200,n=[],a=function(){function t(t){this.target=t,n.length>0?this.buffer=n.pop():this.buffer=r.default.gl.createBuffer(),this.buffer=r.default.gl.createBuffer()}return t.prototype.bind=function(){r.default.gl.bindBuffer(this.target,this.buffer)},t.prototype.bufferData=function(t,e,i){void 0===i&&(i=!1),i||this.bind();var o=r.default.gl;this.target===WebGLRenderingContext.ARRAY_BUFFER?o.bufferData(WebGLRenderingContext.ARRAY_BUFFER,new Float32Array(t),e):this.target===WebGLRenderingContext.ELEMENT_ARRAY_BUFFER&&o.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),e)},t.prototype.destroy=function(){this.buffer&&(n.length<o?n.push(this.buffer):r.default.gl.deleteBuffer(this.buffer),r.default.gl.deleteBuffer(this.buffer)),this.buffer=null},t}();e.default=a},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.i=t.i,this.p=t.p,this.uv=t.uv,this.n=t.n,this.c=t.c}return t}();e.default=i},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(19),n=i(16),a=i(21),s=i(26),l=function(t){function e(e){var i=t.call(this)||this;return i.level=e,i}return r(e,t),e.prototype.getLevel=function(){return this.level},e.prototype.showAllTiles=function(){this.visible=!0,this.children.forEach(function(t){t.setVisible(!0)})},e.prototype.hideAllTiles=function(){this.visible=!1,this.children.forEach(function(t){t.setVisible(!1)})},e.prototype.add=function(e){e.tileInfo.level===this.level&&(t.prototype.add.call(this,e),e.subTiledLayer=this)},e.prototype.findTile=function(t,e,i){for(var r=this.children.length,o=0;o<r;o++){var n=this.children[o];if(n.tileInfo.level===t&&n.tileInfo.row===e&&n.tileInfo.column===i)return n}return null},e.prototype.updateTiles=function(t,e,i){function r(t,e,i,r){for(var o={isExist:!1,index:-1},n=0;n<t.length;n++){var a=t[n];if(a.level===e&&a.row===i&&a.column===r)return o.isExist=!0,o.index=n,o}return o}this.level=t;var o,n,a=[];for(o=0;o<this.children.length;o++){n=this.children[o];var l=r(e,n.tileInfo.level,n.tileInfo.row,n.tileInfo.column),u=l.isExist;u?e.splice(l.index,1):a.push(n)}for(;a.length>0;){var c=this.remove(a[0]);a.splice(0,1),c||console.debug("subTiledLayer.remove(tilesNeedDelete[0])失败")}if(i)for(o=0;o<e.length;o++){var h=e[o],f={level:h.level,row:h.row,column:h.column,url:""};f.url=this.getTileUrl(f.level,f.row,f.column),n=s.default.getInstance(f.level,f.row,f.column,f.url),this.add(n)}},e.prototype.getTileUrl=function(t,e,i){return this.parent&&"function"==typeof this.parent.getTileUrl?this.parent.getTileUrl(t,e,i):""},e.prototype.checkIfAllTilesLoaded=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e){var i=e.material.isReady();if(!i)return!1}}return!0},e.prototype.getExtent=function(){return o.default.union(this.getExtents())},e.prototype.getExtents=function(){return this.children.map(function(t){return t.getExtent()})},e.prototype.getVisibleTileGrids=function(){var t=[];return this.visible&&this.children.forEach(function(e){e.visible&&t.push(new n.default(e.tileInfo.level,e.tileInfo.row,e.tileInfo.column))}),t},e.prototype.getShouldDrawTilesCount=function(){return this.visible?this.children.filter(function(t){return t.visible&&t.isReady()}).length:0},e}(a.default);e.default=l},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(26),a=i(38),s=function(t){function e(){var e=t.call(this,-1)||this;return e.minLevel=4,e}return r(e,t),e.prototype.onDraw=function(e){var i=n.default.findProgram();if(i){i.use();var r=o.default.gl;r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);var a=e.getProjViewMatrixForDraw(),s=i.getUniformLocation("uPMVMatrix");r.uniformMatrix4fv(s,!1,a.getFloat32Array()),r.activeTexture(r.TEXTURE0);var l=i.getUniformLocation("uSampler");r.uniform1i(l,0),r.depthFunc(r.ALWAYS),t.prototype.onDraw.call(this,e),r.depthFunc(r.LEQUAL),r.disable(r.BLEND)}},e.prototype.updateTiles=function(e,i){var r=this,o=i.filter(function(t){return t.level>=r.minLevel});t.prototype.updateTiles.call(this,e,o,!0)},e}(a.default);e.default=s},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(25),n=i(39),a=function(t){function e(e){void 0===e&&(e="Default");var i=t.call(this,e)||this;return i.idx=1,i}return r(e,t),e.prototype.getTileUrl=function(t,e,i){void 0===this.idx&&(this.idx=1);var r="";return r="Satellite"===this.style?"//webst0"+this.idx+".is.autonavi.com/appmaptile?style=6&x="+i+"&y="+e+"&z="+t:"//webst0"+this.idx+".is.autonavi.com/appmaptile?style=7&x="+i+"&y="+e+"&z="+t,this.idx++,this.idx>=5&&(this.idx=1),r},e}(o.default);e.AutonaviTiledLayer=a;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.idx=1,e}return r(e,t),e.prototype.getTileUrl=function(t,e,i){void 0===this.idx&&(this.idx=1);var r="//webst0"+this.idx+".is.autonavi.com/appmaptile?style=8&x="+i+"&y="+e+"&z="+t;return this.idx++,this.idx>=5&&(this.idx=1),r},e}(n.default);e.AutonaviLabelLayer=s},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(27),a=i(42),s=i(31),l=i(13),u=i(43),c=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.geometry=e,r.material=i,r}return r(e,t),e.getInstance=function(){var t=new a.default,i=new s.default(u,!1);return new e(t,i)},e.prototype.shouldDraw=function(e){return!e.isEarthFullOverlapScreen()&&t.prototype.shouldDraw.call(this,e)},e.prototype.onDraw=function(e){var i=o.default.gl;i.disable(WebGLRenderingContext.DEPTH_TEST),i.depthMask(!1),i.enable(WebGLRenderingContext.BLEND),i.blendFunc(WebGLRenderingContext.SRC_ALPHA,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA),this.geometry.getMatrix().setUnitMatrix();var r=o.default.EARTH_RADIUS,n=e.getDistance2EarthOrigin(),a=Math.sqrt(n*n-r*r),s=a/n,u=a*s,c=e.getLightDirection().setLength(u),h=l.default.verticePlusVector(e.getPosition(),c);this.geometry.setPosition(h),this.geometry.setVectorX(e.getVectorX()),this.geometry.setVectorY(e.getVectorY()),this.geometry.setVectorZ(e.getVectorZ()),this.geometry.localScale(s,s,s),t.prototype.onDraw.call(this,e),i.enable(WebGLRenderingContext.DEPTH_TEST),i.depthMask(!0),i.disable(WebGLRenderingContext.BLEND)},e}(n.default);e.default=c},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(37),a=i(35),s=i(34),l=i(12),u=i(17),c=function(t){function e(){var e=t.call(this)||this;return e.segment=360,e.radius1=.99*o.default.EARTH_RADIUS,e.radius2=1.01*o.default.EARTH_RADIUS,e.buildTriangles(),e}return r(e,t),e.prototype.buildTriangles=function(){this.vertices=[],this.triangles=[];var t=new u.default;t.setPosition(new l.default(0,this.radius1,0));var e=[],i=new u.default;i.setPosition(new l.default(0,this.radius2,0));for(var r=[],o=2*-Math.PI/this.segment,s=1/this.segment,c=0,h=0;h<=this.segment;h++){if(c=s*h,c>1&&(c=1),e.push(new n.default({i:h,p:t.getPosition().getArray(),uv:[c,1]})),r.push(new n.default({i:this.segment+1+h,p:i.getPosition().getArray(),uv:[c,0]})),h>0){var f=r[h-1],p=e[h-1],d=r[h],v=e[h];(y=this.triangles).push.apply(y,a.default.assembleQuad(f,p,d,v))}t.worldRotateZ(o),i.worldRotateZ(o)}(g=this.vertices).push.apply(g,e.concat(r));var y,g},e}(s.default);e.default=c},function(t,e,i){t.exports=i.p+"f42e74f3a391873a7d0d2ec2ae63eff9.png"},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(45),n=i(46),a=i(47),s=function(t){function e(e,i){var r=t.call(this,e)||this;return r.globe=i,r}return r(e,t),e.prototype.setLonLat=function(t,e){this.setLonlats([[t,e]])},e.prototype.destroy=function(){this.globe=null,t.prototype.destroy.call(this)},e.prototype.isReady=function(){return this.globe&&this.globe.camera.isEarthFullOverlapScreen()&&t.prototype.isReady.call(this)},e.getInstance=function(t){var i=new n.default(a,24);return new e(i,t)},e}(o.default);e.default=s},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(11),a=i(28),s=i(29),l=i(36),u="\nattribute vec3 aPosition;\nuniform mat4 uPMVMatrix;\nuniform float uSize;\n\nvoid main(void) {\n  gl_Position = uPMVMatrix * vec4(aPosition, 1.0);\n  gl_PointSize = uSize;\n}\n",c="\nprecision mediump float;\nuniform sampler2D uSampler;\n\nvoid main()\n{\n\tvec4 color = texture2D(uSampler, vec2(gl_PointCoord.x, gl_PointCoord.y));\n    if(color.a == 0.0){\n        discard;\n    }\n    gl_FragColor = color;\n}\n",h=function(t){function e(e){var i=t.call(this,null,e)||this;return i.material=e,i.vbo=null,i.vertices=null,i.vbo=new l.default(WebGLRenderingContext.ARRAY_BUFFER),i.vertices=[],i}return r(e,t),e.prototype.createProgram=function(){return a.default.getProgram(u,c)},e.prototype.isReady=function(){return!!(this.vertices.length>0&&this.material&&this.material.isReady())},e.prototype.onDraw=function(t){var e=o.default.gl;e.disable(WebGLRenderingContext.DEPTH_TEST),e.depthMask(!1),e.enable(WebGLRenderingContext.BLEND),e.blendFunc(WebGLRenderingContext.SRC_ALPHA,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA);var i=this.program.getAttribLocation("aPosition");this.program.enableVertexAttribArray("aPosition"),this.vbo.bind();var r=[];this.vertices.map(function(t){r.push(t.x,t.y,t.z)}),this.vbo.bufferData(r,WebGLRenderingContext.DYNAMIC_DRAW,!0),e.vertexAttribPointer(i,3,WebGLRenderingContext.FLOAT,!1,0,0);var n=t.getProjViewMatrixForDraw(),a=this.program.getUniformLocation("uPMVMatrix");e.uniformMatrix4fv(a,!1,n.getFloat32Array());var s=this.program.getUniformLocation("uSize");e.uniform1f(s,this.material.size);var l=this.program.getUniformLocation("uSampler");e.activeTexture(WebGLRenderingContext.TEXTURE0),e.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.material.texture),e.uniform1i(l,0),e.drawArrays(WebGLRenderingContext.POINTS,0,r.length/3),e.enable(WebGLRenderingContext.DEPTH_TEST),e.depthMask(!0),e.disable(WebGLRenderingContext.BLEND)},e.prototype.setLonlats=function(t){var i=this;e.prototype.clear.apply(this),this.vertices=[],t.forEach(function(t){var e=n.default.geographicToCartesianCoord(t[0],t[1],o.default.EARTH_RADIUS+.001);i.vertices.push(e)})},e.prototype.clear=function(){this.vertices=[]},e}(s.default);e.default=h},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(31),n=function(t){function e(e,i){void 0===i&&(i=16);var r=t.call(this,e,!1)||this;return r.size=i,r}return r(e,t),e}(o.default);e.default=n},function(t,e,i){t.exports=i.p+"0a1a7c4881e6fd01b9ef9772a7e1b2f3.png"},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(7),a=i(11),s=i(45),l=i(46),u=i(49),c=i(50),h=function(){function t(t,e,i,r,o,n,a){this.x=t,this.y=e,this.z=i,this.uuid=r,this.name=o,this.address=n,this.phone=a}return t}(),f=function(t){function e(e){var i=t.call(this,e)||this;return i.material=e,i.keyword=null,i.searchExtentMode=!1,i.pois=null,i.globe=null,i.pois=[],n.default.subscribe("extent-change",function(){i.searchExtentMode&&i.keyword&&i.search(i.keyword)}),i}return r(e,t),e.getInstance=function(){var t=new l.default(c,16);return new e(t)},e.prototype.isReady=function(){return this.globe&&this.globe.camera.isEarthFullOverlapScreen()&&t.prototype.isReady.call(this)},e.prototype.destroy=function(){this.globe=null,t.prototype.destroy.call(this)},e.prototype.clear=function(){t.prototype.clear.call(this),this.keyword=null,this.pois=[]},e.prototype._addPoi=function(t,e,i,r,n,s){var l=a.default.geographicToCartesianCoord(t,e,o.default.EARTH_RADIUS+.001),u=new h(l.x,l.y,l.z,i,r,n,s);return this.pois.push(u),u},e.prototype._showPois=function(t){var e=this;console.log("response:",t);var i=t.detail.pois||[],r=i.map(function(t){var i=parseFloat(t.pointx),r=parseFloat(t.pointy);return e._addPoi(i,r,t.uid,t.name,t.addr,t.phone),[i,r]});this.setLonlats(r)},e.prototype.search=function(t){var e=this;if(this.globe){this.searchExtentMode=!0,this.clear(),this.keyword=t;var i=this.globe.getLevel();if(i>=10){var r=this.globe.getExtent();u.default.searchByExtent(t,i,r).then(function(t){e._showPois(t)})}}},e.prototype.searchNearby=function(t,e,i,r){var o=this;return void 0===e&&(e=1e3),void 0===i&&(i=50),void 0===r&&(r=0),this.searchExtentMode=!1,u.default.searchNearby(t,e,!1,i,r).then(function(t){return o._showPois(t),t})},e}(s.default);e.default=f},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(11),o=function(){function t(){}return t.jsonp=function(t,e,i,r,o){function n(){delete window[a],s.src="",s.parentNode&&s.parentNode.removeChild(s),s=null}void 0===i&&(i=""),void 0===r&&(r="cb"),void 0===o&&(o="QQ");var a=o+"_webglobe_callback_"+Math.random().toString().substring(2);t+=t.indexOf("?")<0?"?":"&",t+=r+"=window."+a;var s=document.createElement("script");s.setAttribute("src",t),i&&s.setAttribute("charset",i),s.setAttribute("async","true"),s.setAttribute("defer","true"),document.body.appendChild(s);var l=!1;return window[a]=function(t){l||e(t),n()},function(){l=!0,n()}},t.getCityLocation=function(){var e=this,i=new Promise(function(i){if(e.cityLocation)i(e.cityLocation);else{var r="//apis.map.qq.com/jsapi?qt=gc&output=jsonp";t.jsonp(r,function(t){console.log("定位：",t);var r=t.detail;t.detail?(e.cityLocation={lon:parseFloat(r.pointx),lat:parseFloat(r.pointy),accuracy:1/0,city:r.cname},i(e.cityLocation)):i(null)})}});return i},t.getCurrentPosition=function(t){var e=this;void 0===t&&(t=!1);var i=new Promise(function(i){e.getCityLocation().then(function(r){t?navigator.geolocation.getCurrentPosition(function(t){var o={lon:t.coords.longitude,lat:t.coords.latitude,accuracy:t.coords.accuracy,city:r.city};e.location=o,i(e.location)},function(t){console.error(t),i(e.location?e.location:r)},{enableHighAccuracy:!0}):i(e.location?e.location:r)})});return i},t.searchByExtent=function(e,i,r,o,n){var a=r.minLon,s=r.minLat,l=r.maxLon,u=r.maxLat;void 0===o&&(o=50),void 0===n&&(n=0);var c=new Promise(function(r){var c="//apis.map.qq.com/jsapi?qt=syn&wd="+e+"&pn="+n+"&rn="+o+"&output=jsonp&b="+a+","+s+","+l+","+u+"&l="+i+"&c=000000";t.jsonp(c,function(t){r(t)})});return c},t.searchByBuffer=function(e,i,r,o,n,a){void 0===n&&(n=50),void 0===a&&(a=0);var s=new Promise(function(s){var l="//apis.map.qq.com/jsapi?qt=rn&wd="+e+"&pn="+a+"&rn="+n+"&px="+i+"&py="+r+"&r="+o+"&output=jsonp";t.jsonp(l,function(t){s(t)})});return s},t.searchByCity=function(e,i,r,o){void 0===r&&(r=50),void 0===o&&(o=0);var n=new Promise(function(n){var a="//apis.map.qq.com/jsapi?qt=poi&wd="+e+"&pn="+o+"&rn="+r+"&c="+i+"&output=jsonp";t.jsonp(a,function(t){n(t)})});return n},t.searchNearby=function(t,e,i,r,o){var n=this;return void 0===e&&(e=1e3),void 0===i&&(i=!1),void 0===r&&(r=50),void 0===o&&(o=0),this.getCurrentPosition(i).then(function(i){return n.searchByBuffer(t,i.lon,i.lat,e,r,o)})},t.searchByCurrentCity=function(t,e,i){var r=this;return void 0===e&&(e=50),void 0===i&&(i=0),this.getCityLocation().then(function(o){return r.searchByCity(t,o.city,e,i)})},t._handleRouteResult=function(t){var e=JSON.parse(t);return e.route&&e.route.paths&&e.route.paths.length>0&&e.route.paths.forEach(function(t){t.steps&&t.steps.forEach(function(t){var e=t.polyline.split(";"),i=e.map(function(t){var e=t.split(","),i=parseFloat(e[0]),r=parseFloat(e[1]);return[i,r]});t.firstLonlat=i[0],t.lastLonlat=i[i.length-1],t.lonlats=i})}),e},t.routeByDriving=function(t,e,i,r,o,n){var a=this;void 0===n&&(n=5);var s=new Promise(function(s,l){var u="//restapi.amap.com/v3/direction/driving?origin="+t+","+e+"&destination="+i+","+r+"&extensions=base&output=json&key="+o+"&strategy="+n,c=new XMLHttpRequest;c.open("GET",u,!0),c.onload=function(t){var e=a._handleRouteResult(t.target.responseText);s(e)},c.onerror=function(t){l(t)},c.onabort=function(t){l(t)},c.send()});return s},t.decodeQQPolyline=function(t){for(var e=2;e<t.length;e++)t[e]=t[e-2]+t[e]/1e6;return t},t.qqRouteByDriving=function(e,i,r,o,n,a){var s="//apis.map.qq.com/ws/direction/v1/driving/?from="+i+","+e+"&to="+o+","+r+"&output=jsonp&key="+n;a&&(s+="&policy="+a);var l=new Promise(function(e){t.jsonp(s,function(i){i.result.routes.forEach(function(e){t.decodeQQPolyline(e.polyline)}),e(i)})});return l},t.qqRoute=function(e,i,o,n,a){var s=r.default.degreeLonToWebMercatorX(i,!0),l=r.default.degreeLatToWebMercatorY(o,!0),u=r.default.degreeLonToWebMercatorX(n,!0),c=r.default.degreeLatToWebMercatorY(a,!0),h="//apis.map.qq.com/jsapi?qt="+e+"&start=1$$$$"+s+", "+l+"$$&dest=1$$$$"+u+", "+c+"$$&cond=3&mt=2&s=2&fm=0&output=jsonp&pf=jsapi&ref=jsapi",f=new Promise(function(e){t.jsonp(h,function(t){console.log(t),e(t)},"GBK")});return f},t}();o.cityLocation=null,o.location=null,e.default=o},function(t,e,i){t.exports=i.p+"c50c9e16c733d316c8cc79f806d50c11.png"},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(7),a=i(11),s=i(13),l=i(37),u=i(34),c=i(52),h=i(53),f=i(21),p=i(49),d=function(t){function e(e,i,r,o){var n=t.call(this,null,o)||this;return n.lonlats=e,n.pixelWidth=i,n.updateGeometry(r),n}return r(e,t),e.prototype.updateGeometry=function(t){var e=this._getRouteGeometryByLonlats(this.lonlats,t,this.pixelWidth);this.setGeometry(e)},e.prototype._getRouteGeometryByLonlats=function(t,e,i){for(var r=new u.default,o=t.map(function(t){return a.default.geographicToCartesianCoord(t[0],t[1])}),n=[],l=0;l<o.length-1;l++){var c=o[l],h=o[l+1],f=s.default.verticeMinusVertice(h,c);n.push(f)}n.push(n[n.length-1]);for(var p=0,d=[],l=0;l<o.length;l++){var c=o[l],f=n[l],v=this._getRouteVertices(p,c,f,e,i);p=v.startIndex,d.push([v.v1,v.v3]),r.vertices.push(v.v1,v.v3)}for(var l=0;l<d.length-1;l++){var y=d[l][0],g=d[l][1],m=d[l+1][0],_=d[l+1][1],b=u.default.buildPlane(m,y,_,g);(w=r.triangles).push.apply(w,b)}return r;var w},e.prototype._getRouteVertices=function(t,e,i,r,o){var n=s.default.fromVertice(e),a=i.getOpposite(),u=r*o/2,c=n.cross(i).setLength(u),h=s.default.verticePlusVector(e,c).getArray(),f=new l.default({i:t++,p:h}),p=n.cross(a).setLength(u),d=s.default.verticePlusVector(e,p).getArray(),v=new l.default({i:t++,p:d});return{startIndex:t,v1:f,v3:v}},e}(c.default),v=function(t){function e(e){var i=t.call(this)||this;return i.camera=e,i.pixelWidth=5,n.default.subscribe("level-change",function(){if(i.children.length>0){var t=i._getResolution();i.children.forEach(function(e){e instanceof d&&e.updateGeometry(t)})}}),i}return r(e,t),e.prototype.test=function(t,e,i){void 0===t&&(t=5),void 0===e&&(e=100),void 0===i&&(i=[0,1,0]);var r=[116,40],o=[116,25];this.addRouteByLonlat(r,o,t,e,i)},e.prototype.addRouteByLonlat=function(t,e,i,r,o){var n=this._getLonlatsBySegments(t,e,r);return this.addRouteByLonlats(n,i,o)},e.prototype.addRouteByLonlats=function(t,e,i,r){void 0===r&&(r=-1),r<0&&(r=this._getResolution());var o=new d(t,e,r,new h.default(i));return this.add(o),o},e.prototype._getResolution=function(){var t=this.camera.measureXYResolutionAndBestDisplayLevel(),e=t.resolutionX,i=(t.bestDisplayLevelFloatX,t.resolutionY);t.bestDisplayLevelFloatY;return(e+i)/2},e.prototype._getLonlatsBySegments=function(t,e,i){for(var r=(e[0]-t[0])/i,o=(e[1]-t[1])/i,n=[],a=0;a<i;a++){var s=[t[0]+r*a,t[1]+o*a];n.push(s)}return n.push(e),n},e.prototype.routeByDriving=function(t,e,i,r,o,n){var a=this;return void 0===n&&(n=5),p.default.routeByDriving(t,e,i,r,o,n).then(function(t){if(console.log(t),a.clear(),t.route&&t.route.paths.length>0){var e=t.route.paths[0],i=[0,1,0];e.steps.forEach(function(t,e,r){if(0!==e){var o=r[e-1],n=[o.lastLonlat,t.firstLonlat];a.addRouteByLonlats(n,a.pixelWidth,i)}a.addRouteByLonlats(t.lonlats,a.pixelWidth,i)})}})},e.prototype.onDraw=function(e){var i=o.default.gl;i.disable(WebGLRenderingContext.DEPTH_TEST),i.depthMask(!1),t.prototype.onDraw.call(this,e),i.enable(WebGLRenderingContext.DEPTH_TEST),i.depthMask(!0)},e.prototype.destroy=function(){this.camera=null,t.prototype.destroy.call(this)},e.getInstance=function(t){return new e(t)},e}(f.default);e.default=v},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(28),a=i(29),s="\nattribute vec3 aPosition;\nattribute vec3 aColor;\nvarying vec4 vColor;\nuniform mat4 uPMVMatrix;\n\nvoid main()\n{\n\tgl_Position = uPMVMatrix * vec4(aPosition,1.0);\n\tvColor = vec4(aColor,1.0);\n}\n",l="\nprecision mediump float;\nvarying vec4 vColor;\n\nvoid main()\n{\n\tgl_FragColor = vColor;\n}\n",u=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.geometry=e,r.material=i,r.setGeometry(e),r}return r(e,t),e.prototype.setGeometry=function(t){var e=this;this.geometry&&this.geometry.destroy(),this.geometry=t,this.geometry&&(this.geometry.vertices.forEach(function(t){t.c=e.material.color}),this.geometry.calculateVBO(),this.geometry.calculateIBO(),this.geometry.calculateCBO())},e.prototype.isGeometryReady=function(){return!!this.geometry.vbo&&!!this.geometry.ibo&&!!this.geometry.cbo},e.prototype.isReady=function(){return this.isGeometryReady()&&t.prototype.isReady.call(this)},e.prototype.createProgram=function(){return n.default.getProgram(s,l)},e.prototype.updateShaderUniforms=function(t){var e=o.default.gl,i=t.getProjViewMatrixForDraw().multiplyMatrix(this.geometry.getMatrix()),r=this.program.getUniformLocation("uPMVMatrix");e.uniformMatrix4fv(r,!1,i.getFloat32Array())},e.prototype.onDraw=function(t){var e=o.default.gl;this.updateShaderUniforms(t);var i=this.program.getAttribLocation("aPosition");this.program.enableVertexAttribArray("aPosition"),this.geometry.vbo.bind(),e.vertexAttribPointer(i,3,WebGLRenderingContext.FLOAT,!1,0,0);var r=this.program.getAttribLocation("aColor");this.program.enableVertexAttribArray("aColor"),this.geometry.cbo.bind(),e.vertexAttribPointer(r,3,WebGLRenderingContext.FLOAT,!1,0,0),this.geometry.ibo.bind();var n=3*this.geometry.triangles.length;e.drawElements(WebGLRenderingContext.TRIANGLES,n,WebGLRenderingContext.UNSIGNED_SHORT,0)},e}(a.default);e.default=u},function(t,e,i){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=i(32),n=function(t){function e(e){var i=t.call(this)||this;return i.color=e,i}return r(e,t),e.prototype.isReady=function(){return this.color&&this.color.length>0},e.prototype.destroy=function(){},e}(o.default);e.default=n},function(t,e){}]);